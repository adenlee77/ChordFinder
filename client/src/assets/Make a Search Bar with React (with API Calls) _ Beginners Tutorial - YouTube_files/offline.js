(function(g){var window=this;'use strict';var Itc=function(p){var C=new g.Lz("und",new g.BR("Default","und",!0));C.captionTracks=p.captionTracks;return C},bNy=function(p){return new g.mo(function(C,V){var N=p.length,H=[];
if(N)for(var X=function(l,t){N--;H[l]=t;N==0&&C(H)},d=function(l){V(l)},a,E=0;E<p.length;E++)a=p[E],g.QtV(a,g.Wv(X,E),d);
else C(H)})},Ai=function(p){this.T=p},oU=function(){Ai.apply(this,arguments)},A$c=function(){oU.apply(this,arguments)},oNc=function(){oU.apply(this,arguments)},kqE=function(){oU.apply(this,arguments)},xj8=function(){oU.apply(this,arguments)},Y$F=function(){oU.apply(this,arguments)},zZ8=function(){Ai.apply(this,arguments)},RZG=function(){oU.apply(this,arguments)},nN2=function(){oU.apply(this,arguments)},eZ0=function(){oU.apply(this,arguments)},P3v=function(){oU.apply(this,arguments)},wi2=function(){oU.apply(this,
arguments)},$j5=function(){oU.apply(this,arguments)},L0f=function(){oU.apply(this,arguments)},gNY=function(){oU.apply(this,arguments)},W0v=function(){oU.apply(this,arguments)},QXr=function(){oU.apply(this,arguments)},r$P=function(){oU.apply(this,arguments)},BUY=function(){oU.apply(this,arguments)},GqE=function(){Ai.apply(this,arguments)},p28=function(){oU.apply(this,arguments)},CpE=function(){oU.apply(this,arguments)},js5=function(){oU.apply(this,arguments)},VZf=function(){oU.apply(this,arguments)},
Nhv=function(){oU.apply(this,arguments)},HE8=function(){oU.apply(this,arguments)},X2Y=function(){oU.apply(this,arguments)},d_E=function(){oU.apply(this,arguments)},iEF=function(){oU.apply(this,arguments)},hpr=function(){Ai.apply(this,arguments)},ssF=function(){Ai.apply(this,arguments)},aq2=function(){Ai.apply(this,arguments)},E30=function(){oU.apply(this,arguments)},lq0=function(){oU.apply(this,arguments)},tZE=function(){oU.apply(this,arguments)},cEY=function(){oU.apply(this,arguments)},Thf=function(){oU.apply(this,
arguments)},MZv=function(){oU.apply(this,arguments)},JEp=function(){oU.apply(this,arguments)},m_f=function(){oU.apply(this,arguments)},v3f=function(){oU.apply(this,arguments)},Fn5=function(){oU.apply(this,arguments)},SVv=function(){oU.apply(this,arguments)},Kn0=function(){oU.apply(this,arguments)},D_1=function(){oU.apply(this,arguments)},ufE=function(){oU.apply(this,arguments)},ZEv=function(){oU.apply(this,arguments)},U_P=function(){oU.apply(this,arguments)},fq1=function(){oU.apply(this,arguments)},
OEY=function(){oU.apply(this,arguments)},yE2=function(){oU.apply(this,arguments)},qV5=function(){oU.apply(this,arguments)},Iq8=function(){oU.apply(this,arguments)},bEv=function(){oU.apply(this,arguments)},AEc=function(){oU.apply(this,arguments)},o3p=function(){oU.apply(this,arguments)},ki1=function(){oU.apply(this,arguments)},x_F=function(){Ai.apply(this,arguments)},YVr=function(){oU.apply(this,arguments)},zpf=function(){oU.apply(this,arguments)},Rpy=function(){oU.apply(this,arguments)},n32=function(){oU.apply(this,
arguments)},ep5=function(){oU.apply(this,arguments)},Ppv=function(){oU.apply(this,arguments)},w22=function(){oU.apply(this,arguments)},$_E=function(){oU.apply(this,arguments)},Lnc=function(){oU.apply(this,arguments)},g3y=function(){oU.apply(this,arguments)},Wn1=function(){oU.apply(this,arguments)},Qsr=function(){oU.apply(this,arguments)},rEr=function(){oU.apply(this,arguments)},BhG=function(){oU.apply(this,arguments)},GiE=function(){oU.apply(this,arguments)},psY=function(){oU.apply(this,arguments)},
CZG=function(){oU.apply(this,arguments)},jof=function(){oU.apply(this,arguments)},V1y=function(){oU.apply(this,arguments)},NT0=function(){oU.apply(this,arguments)},Hh1=function(){oU.apply(this,arguments)},Xsc=function(){oU.apply(this,arguments)},dk0=function(){oU.apply(this,arguments)},ihF=function(){oU.apply(this,arguments)},hu1=function(){oU.apply(this,arguments)},sop=function(){oU.apply(this,arguments)},aeG=function(){oU.apply(this,arguments)},EcE=function(){oU.apply(this,arguments)},ler=function(){oU.apply(this,
arguments)},t1y=function(p){p=p.key||p.id;
if(!p)throw Error("Entity key is missing");return p},cUp=function(){if(k8)return k8();
var p={};k8=g.p5("PersistentEntityStoreDb",{ZJ:(p.EntityStore={Ck:1},p.EntityAssociationStore={Ck:2},p),shared:!1,upgrade:function(C,V){V(1)&&g.op(g.O2(C,"EntityStore",{keyPath:"key"}),"entityType","entityType");V(2)&&(C=g.O2(C,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.op(C,"byParentEntityKey","parentEntityKey"),g.op(C,"byChildEntityKey","childEntityKey"))},
version:3});return k8()},TTY=function(p){return g.PW(cUp(),p)},M1p=function(p){return g.PW((0,g.rBY)(),p)},x8=function(p){this.token=p},Y8=function(p,C){C=C===void 0?{}:C;
g.LK.call(this,g.Bo0[p],Object.assign({},{name:"PESEncoderError",type:p},C));this.type=p;this.level="WARNING";Object.setPrototypeOf(this,Y8.prototype)},JUE=function(p){return new Y8("WRONG_DATA_TYPE",{ZL:p})},mkG=function(p){return p instanceof Error?new Y8("UNKNOWN_ENCODE_ERROR",{xj:p.message}):new Y8("UNKNOWN_ENCODE_ERROR")},vcr=function(p){return p instanceof Error?new Y8("UNKNOWN_DECODE_ERROR",{xj:p.message}):new Y8("UNKNOWN_DECODE_ERROR")},Fgp=function(p,C){p=p instanceof Y8?p:C(p);
g.AG(p);throw p;},Shy=function(){},KgP=function(p,C,V){try{return p.V(C,V)}catch(N){Fgp(N,mkG)}},Dk5=function(p){p=(new TextEncoder).encode(p).subarray(0,16);
var C=new Uint8Array(16);C.set(p);return C},za=function(p){this.T=p},Zh0=function(p){var C=uL2[p];
if(C)return C;g.oW(new g.LK("Entity model not found.",{entityType:p}))},UkY=function(p,C){this.T=p;
this.C=C;this.V={}},OhY=function(p,C){a:{p=fep(p.C,C.version);
try{var V=p.C(C.data,C.key);break a}catch(N){Fgp(N,vcr)}V=void 0}return V},RU=function(p,C,V){return p.T.objectStore("EntityStore").get(C).then(function(N){if(N){if(V&&N.entityType!==V)throw Error("Incorrect entity type");
return OhY(p,N)}})},nC=function(p,C,V){return V?(V=V.map(function(N){return RU(p,N,C)}),g.K3.all(V)):p.T.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(C)).then(function(N){return N.map(function(H){return OhY(p,H)})})},P9=function(p,C,V){var N=t1y(C),H=fep(p.C,1),X=Object.assign({},C);
return p.T.objectStore("EntityStore").get(N).then(function(d){if(d){if(d.entityType!==V)throw Error("Incorrect entity type");X.entityMetadata||(d=OhY(p,d),X.entityMetadata=d.entityMetadata)}}).then(function(){var d={key:N,
entityType:V,data:KgP(H,X,N),version:1};return g.K3.all([g.Ip(p.T.objectStore("EntityStore"),d),yUp(p,X,V)])}).then(function(){eN(p,N,V);
return N})},qhr=function(p,C,V){C=C.map(function(N){return P9(p,N,V)});
return g.K3.all(C)},wp=function(p,C,V){if(V==null?0:V.Ar){var N=new Set;
return Ie1(p,C,N).then(function(){for(var X=[],d=g.F(N),a=d.next();!a.done;a=d.next())X.push(wp(p,a.value));return g.K3.all(X).then(function(){})})}var H=g.Xq(C).entityType;
return g.K3.all([p.T.objectStore("EntityStore").delete(C),bhv(p,C)]).then(function(){eN(p,C,H)})},AU2=function(p,C){return g.z4(p.T.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(C)},function(V){return g.K3.all([V.delete(),
bhv(p,V.cursor.primaryKey)]).then(function(){eN(p,V.cursor.primaryKey,C);return g.xt(V)})})},ocy=function(p,C,V,N){var H=fep(p.C,1);
return RU(p,C,N).then(function(X){if(X){X=g.Zf(X,V);var d={key:C,entityType:N,data:KgP(H,X,C),version:1};return g.K3.all([g.Ip(p.T.objectStore("EntityStore"),d),yUp(p,X,N)])}}).then(function(){eN(p,C,N);
return C})},eN=function(p,C,V){var N=p.V[V];
N||(N=new Set,p.V[V]=N);N.add(C)},kyy=function(p,C,V){var N=t1y(C);
V=Zh0(V);if(!V)return g.K3.resolve([]);V=new V(C);p=p.T.objectStore("EntityAssociationStore");C=[];V=g.F(V.C());for(var H=V.next();!H.done;H=V.next())C.push(g.Ip(p,{parentEntityKey:N,childEntityKey:H.value}));return g.K3.all(C).then(function(X){return X.map(function(d){return d[1]})})},bhv=function(p,C){return p.T.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(C))},yUp=function(p,C,V){var N=t1y(C);
return bhv(p,N).then(function(){return kyy(p,C,V)})},Ie1=function(p,C,V){if(V.has(C))return g.K3.resolve(void 0);
V.add(C);return xk0(p,C).then(function(N){return p.T.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(C)).then(function(){return N})}).then(function(N){var H=g.K3.resolve(void 0);
N=g.F(N);for(var X=N.next(),d={};!X.done;d={FY:void 0},X=N.next())d.FY=X.value,H=H.then(function(a){return function(){return Ie1(p,a.FY,V)}}(d));
return H}).then(function(){})},xk0=function(p,C){var V=p.T.objectStore("EntityAssociationStore");
return V.index("byParentEntityKey").getAll(IDBKeyRange.only(C)).then(function(N){var H=[];N=g.F(N);for(var X=N.next();!X.done;X=N.next())X=X.value,H.push(V.index("byChildEntityKey").getAll(X.childEntityKey));return g.K3.all(H)}).then(function(N){var H=[];
N=g.F(N);for(var X=N.next();!X.done;X=N.next())X=X.value,X.length===1&&H.push(X[0].childEntityKey);return H})},$8=function(){},Yhc=function(){this.T={};
this.T[0]=new $8;if(!g.F5("aes_pes_encoder_killswitch")){var p=this.T;try{var C=g.g8();var V=Dk5(C);var N=new za(new g.Ss(V),new g.Fq(V))}catch(H){throw p=H instanceof Error?new Y8("KEY_CREATION_FAILED",{xj:H.message}):new Y8("KEY_CREATION_FAILED"),g.AG(p),p;}p[1]=N}},fep=function(p,C){C=C===void 0?0:C;
p=p.T[C];if(!p)throw C=new Y8("INVALID_ENCODER_VERSION",{ZL:C}),g.AG(C),C;return p},LC=function(p,C){g.z.call(this);
this.token=p;this.T=C;this.observers=[];p=new g.xH.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.g8());p.onmessage=this.C.bind(this);this.channel=p},gp=function(p,C,V){var N,H,X,d;
return g.I(function(a){if(a.C==1)return g.y(a,TTY(p.token),2);if(a.C!=3)return N=a.T,g.y(a,g.qp(N,["EntityStore","EntityAssociationStore"],C,function(E){H=new UkY(E,p.T);return V(H)}),3);
X=a.T;H&&(d=H.V,Object.keys(d).length>0&&(p.channel.postMessage(d),zuP(p,d)));return a.return(X)})},W9=function(p,C,V){return gp(p,{mode:"readwrite",
L4:!0},function(N){return P9(N,C,V)})},Ru0=function(p,C){return gp(p,{mode:"readwrite",
L4:!0},function(V){return qhr(V,C,"offlineOrchestrationActionWrapperEntity")})},nc8=function(p,C){return gp(p,{mode:"readwrite",
L4:!0},function(V){return wp(V,C)})},eu2=function(p){return gp(p,{mode:"readwrite",
L4:!0},function(C){return AU2(C,"videoPlaybackPositionEntity")})},Qa=function(p,C,V){return gp(p,{mode:"readonly",
L4:!0},function(N){return RU(N,C,V)})},rp=function(p,C,V){return gp(p,{mode:"readonly",
L4:!0},function(N){return nC(N,C,V)})},zuP=function(p,C){p=g.F(p.observers);
for(var V=p.next();!V.done;V=p.next())V=V.value,V(C)},PZG=function(){var p,C,V;
return g.I(function(N){if(N.C==1)return g.vv(N,2),g.y(N,g.BW(),4);if(N.C!=2){p=N.T;if(!p||!g.Ww()||typeof g.xH.BroadcastChannel==="undefined")return N.return();C=new Yhc;return N.return(new LC(p,C))}V=g.Sa(N);V instanceof Error&&g.AG(V);return N.return()})},B9=function(){wsf||(wsf=PZG());
return wsf},$kp=function(p){var C;
p=(C=p.options)==null?void 0:C.persistenceOption;return p==="ENTITY_PERSISTENCE_OPTION_PERSIST"||p==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},Lg1=function(p){var C;
return g.I(function(V){return V.C==1?g.y(V,B9(),2):(C=V.T)?g.y(V,gp(C,"readwrite",function(N){for(var H={},X=g.F(p),d=X.next(),a={};!d.done;a={eO:void 0,gA:void 0},d=X.next())a.eO=d.value,a.eO.entityKey&&$kp(a.eO)&&(a.gA=g.DH(a.eO.payload),d=void 0,a.eO.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(d=function(E){return function(){return P9(N,E.eO.payload[E.gA],E.gA)}}(a)),a.eO.type==="ENTITY_MUTATION_TYPE_DELETE"&&(d=function(E){return function(){return wp(N,E.eO.entityKey)}}(a)),a.eO.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(d=function(E){return function(){return ocy(N,E.eO.entityKey,E.eO.payload[E.gA],E.gA)}}(a)),d&&(H[a.eO.entityKey]=H[a.eO.entityKey]?H[a.eO.entityKey].then(d):d()));
return g.K3.all(Object.values(H))}),0):V.return()})},gc0=function(p){var C;
return g.I(function(V){if(V.C==1){C=p.mutations;if(!C||C.length<=0)return V.return();if(g.pf){var N={type:"ENTITY_LOADED"};C!==void 0&&(N.payload=C);g.pf.dispatch(N)}return g.y(V,Lg1(C),2)}C.length=0;g.JQ(V)})},Wg2=function(p){return p!==void 0},QoE=function(p){var C=g.MF();
C=Object.assign({},C);p=Object.assign({},p);for(var V in C)p[V]?(C[V]!==4&&(C[V]=p[V]),delete p[V]):C[V]!==2&&(C[V]=4);Object.assign(C,p);g.P_Q(C);JSON.stringify(C);return C},rUP=function(p){var C,V;
return g.I(function(N){if(N.C==1)return g.y(N,g.BW(),2);if(N.C!=3)return(C=N.T)?g.y(N,g.v7(C),3):N.return();V=N.T;return N.return(g.qp(V,["index","media","captions"],{mode:"readwrite",L4:!0},function(H){var X=IDBKeyRange.bound(p+"|",p+"~");H=[H.objectStore("index").delete(X),H.objectStore("media").delete(X),H.objectStore("captions").delete(X)];return g.K3.all(H).then(function(){})}))})},BT0=function(){var p,C;
return g.I(function(V){if(V.C==1)return g.y(V,g.BW(),2);if(V.C!=3){p=V.T;if(!p)throw g.F2("rvdfd");return g.y(V,g.v7(p),3)}C=V.T;return V.return(g.qp(C,["index","media"],{mode:"readwrite",L4:!0},function(N){var H={};return g.kt(N.objectStore("index"),{},function(X){var d=X.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),a=g.K3.resolve(void 0);if(d){var E=d[1];d=d[2];H[E]=H[E]||{};var l;H[E][d]=g.WHy((l=X.getValue())==null?void 0:l.fmts)}else a=X.delete().then(function(){});
return g.K3.all([g.xt(X),a]).then(function(t){return g.F(t).next().value})}).then(function(){for(var X={},d=g.F(Object.keys(H)),a=d.next();!a.done;a=d.next()){a=a.value;
var E=H[a].v;X[a]=H[a].a&&E?1:2}var l=QoE(X);return g.OXH(N.objectStore("media"),{},function(t){var c=t.cursor.key.match(g.Gdv);c&&X[c[1]]||N.objectStore("media").delete(t.cursor.key);return g.vIV(t)}).then(function(){return l})})}))})},Gy0=function(p,C){var V,N;
return g.I(function(H){if(H.C==1)return g.y(H,g.BW(),2);if(H.C!=3){V=H.T;if(!V)throw g.F2("wct");return g.y(H,g.v7(V),3)}N=H.T;return g.y(H,g.qp(N,["captions"],{mode:"readwrite",L4:!0},function(X){var d=[];X=X.objectStore("captions");for(var a=0;a<C.length;a++){var E=g.Ip(X,C[a],p+"|"+C[a].metadata.vss_id);d.push(E)}return g.K3.all(d)}),0)})},pfF=function(p){var C,V,N;
return g.I(function(H){if(H.C==1)return C=IDBKeyRange.bound(p+"|",p+"~"),g.y(H,g.BW(),2);if(H.C!=3){V=H.T;if(!V)throw g.F2("gactfv");return g.y(H,g.v7(V),3)}N=H.T;return H.return(N.getAll("captions",C))})},C41=function(p){return g.I(function(C){g.mx(p,0);
return C.return(rUP(p))})},j9F=function(p){return{context:g.MQ(),
videoIds:p}},Vhy=function(p){return{context:g.MQ(),
playlistIds:p}},N9F=function(p){return{context:g.MQ(),
offlinePlaylistSyncChecks:p}},H2Y=function(){this.T=new Map},dKp=function(){Xfr||(Xfr=new H2Y);
return Xfr},i2G=function(p,C){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:p},metadata:C,statusCode:void 0,csn:void 0,can:void 0}},hUc=function(p,C,V){if(!V){var N=N===void 0?!1:N;
V=p.T.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!V||N)V=g.D9(16),p.T.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",V)}p={flowNonce:V,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:C.eventType};C.metadata&&(p.flowMetadata=C.metadata);C.statusCode!==void 0&&(p.flowEventStatus=C.statusCode);C.csn&&(p.csn=C.csn);C.can&&(p.can=C.can);g.h1("flowEvent",p,void 0)},s9F=function(p){var C,V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,Y,W,L,VL,au,Q,e,G,m,P,p0,Sy,V8,fY,jy,Tp,r1,u,U,O;
return g.I(function(b){if(b.C==1)return g.y(b,gp(p,{mode:"readonly",L4:!0},function(x){return nC(x,"playbackData").then(function(pY){var d1=pY.map(function(my){return my.transfer}).filter(function(my){return!!my}),Hv=pY.map(function(my){return my.offlineVideoPolicy}).filter(function(my){return!!my}),k=pY.filter(function(my){return!!my.key}).map(function(my){return g.d_(g.Xq(my.key).entityId,"downloadStatusEntity")});
d1=nC(x,"transfer",d1);Hv=nC(x,"offlineVideoPolicy",Hv);k=nC(x,"downloadStatusEntity",k);var ES=d1.then(function(my){my=my.reduce(function(i9,ou){(ou==null?0:ou.offlineVideoStreams)&&i9.push.apply(i9,g.K(ou.offlineVideoStreams));return i9},[]).filter(function(i9){return!!i9});
return nC(x,"offlineVideoStreams",my)});
return g.K3.all([d1,Hv,ES,k]).then(function(my){var i9=g.F(my);my=i9.next().value;var ou=i9.next().value;var iP=i9.next().value;i9=i9.next().value;return[pY,my,ou,iP,i9]})})}),2);
if(b.C!=3)return C=b.T,g.y(b,gp(p,{mode:"readonly",L4:!0},function(x){return nC(x,"mainDownloadsListEntity").then(function(pY){var d1,Hv;return(Hv=(d1=pY[0])==null?void 0:d1.downloads)!=null?Hv:[]})}),3);
V=b.T;N=g.F(C);H=N.next().value;X=N.next().value;d=N.next().value;a=N.next().value;E=N.next().value;l=H;t=X;c=d;T=a;M=E;J={};S={};D={};Z={};f={};q=[];A=g.F(t);for(Y=A.next();!Y.done;Y=A.next())(W=Y.value)&&(J[W.key]=W);L=g.F(c);for(VL=L.next();!VL.done;VL=L.next())(au=VL.value)&&(S[au.key]=au);Q=g.F(M);for(e=Q.next();!e.done;e=Q.next())(G=e.value)&&(D[G.key]=G);m=g.F(T);for(P=m.next();!P.done;P=m.next())(p0=P.value)&&(Z[p0.key]=p0);Sy=g.F(V);for(V8=Sy.next();!V8.done;V8=Sy.next())fY=V8.value,jy=void 0,
f[(jy=fY.videoItem)!=null?jy:""]=!0,fY.videoItem&&(r1=Tp=void 0,u=(r1=(Tp=g.Xq(fY.videoItem))==null?void 0:Tp.entityId)!=null?r1:"",q.push({externalVideoId:u}));U=l.filter(function(x){if(!x||!x.key||!x.offlineVideoPolicy)return!1;x=g.Xq(x.key).entityId;x=g.d_(x,"downloadStatusEntity");var pY;return!(x&&((pY=D[x])==null?void 0:pY.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
O=U.map(function(x){var pY=J[x.transfer],d1=[];if(pY==null?0:pY.offlineVideoStreams)for(var Hv=g.F(pY.offlineVideoStreams),k=Hv.next();!k.done;k=Hv.next())(k=Z[k.value])&&d1.push(k);Hv=S[x.offlineVideoPolicy];k=f;var ES=x==null?void 0:x.playerResponseTimestamp,my=g.Xq(Hv.key).entityId;x=g.d_(my,"mainVideoEntity");if(Hv.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var i9="OFFLINE_VIDEO_STATE_DISABLED";Hv.expirationTimestamp&&Number(Hv.expirationTimestamp)<Date.now()/1E3&&(i9="OFFLINE_VIDEO_STATE_EXPIRED")}else if(Hv.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")i9="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(pY==null?void 0:pY.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":i9="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":i9="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":i9="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":i9="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":i9="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":i9="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:i9="OFFLINE_VIDEO_STATE_UNKNOWN"}if(i9==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(pY==null?void 0:pY.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":i9="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":i9="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":i9=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}my={id:my,videoState:i9};if(pY==null?0:pY.cotn)my.cotn=pY.cotn;if(pY==null?0:pY.maximumDownloadQuality)my.selectedVideoQuality=pY==null?void 0:pY.maximumDownloadQuality;if(pY==null?0:pY.lastProgressTimeMs)my.lastProgressTimeMs=pY.lastProgressTimeMs;ES&&(my.playerResponseSavedTimeMs=String(Number(ES)*1E3));pY=String;ES=0;d1=g.F(d1);for(i9=d1.next();!i9.done;i9=d1.next())if(i9=i9.value,i9.streamsProgress){i9=g.F(i9.streamsProgress);for(var ou=i9.next();!ou.done;ou=
i9.next()){var iP=void 0;ES+=Number((iP=ou.value.numBytesDownloaded)!=null?iP:0)}}my.downloadedBytes=pY(ES);my.selectedOfflineMode=k[x]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";Hv.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(my.offlinePlaybackDisabledReason=Hv.offlinePlaybackDisabledReason);return my});
return b.return({offlineVideos:O,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:q}}})})},aoy=function(){this.locks=navigator.locks},Eoc=function(){try{var p=g.zV("ytglobal.locks_");
if(p)return p;var C;if(C=navigator){var V=navigator;C="locks"in V&&!!V.locks}if(C)return g.xH.localStorage&&g.xH.localStorage.getItem("noop"),p=new aoy,g.YH("ytglobal.locks_",p),p}catch(N){}},Ga=function(){},lo8=function(){},thE=function(p){if(p.includes(":"))throw Error("Invalid user cache name: "+p);
return p+":"+g.g8("CacheStorage get")},cxE=function(){return g.I(function(p){if(p8!==void 0)return p.return(p8);
p8=new Promise(function(C){var V;return g.I(function(N){switch(N.C){case 1:return g.vv(N,2),g.y(N,C8.open("test-only"),4);case 4:return g.y(N,C8.delete("test-only"),5);case 5:g.Fe(N,3);break;case 2:if(V=g.Sa(N),V instanceof Error&&V.name==="SecurityError")return C(!1),N.return();case 3:C("caches"in window),g.JQ(N)}})});
return p.return(p8)})},MhF=function(){return g.I(function(p){if(p.C==1)return g.y(p,cxE(),2);
if(!p.T)return p.return(void 0);T91||(T91=new lo8);return p.return(T91)})},jx=function(p,C,V){g.oW(new g.LK("Woffle: "+p,V?{cotn:V}:""));
C instanceof Error&&g.oW(C)},Jxp=function(p){var C;
return g.I(function(V){if(V.C==1)return g.y(V,s9F(p),2);C=V.T;g.h1("offlineStateSnapshot",C);g.JQ(V)})},VZ=function(p){g.z.call(this);
var C=this;this.api=p;this.VZ={JFr:function(){return C.T},
Cq$:function(){return C.C}};
typeof g.xH.BroadcastChannel!=="undefined"&&(this.T=new g.xH.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.g8()),this.T.onmessage=this.V.bind(this),this.C=new g.xH.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.g8()),this.C.onmessage=this.S.bind(this))},Nw=function(p,C){p.api.Jk("onOfflineOperationFailure",C);
var V;(V=p.T)==null||V.postMessage(C)},mKE=function(p,C,V,N){var H=this;
this.J=p;this.Z=C;this.visibility=V;this.G=N;this.W=this.D=this.Y=this.V=this.T=!1;this.S=new g.Go(function(){H.DH()});
this.VZ={Oe:function(){return H.C},
DH:function(){H.DH()},
SK$:function(){return H.S}};
this.visibility.subscribe("visibilitystatechange",function(){H.d6()})},vo8=function(p){if(!p.V&&!p.T){var C=Eoc();
if(C){p.V=!0;var V=g.g8("OfflineLockManager");C.request("woffle_orchestration_leader:"+V,{},function(){var N,H,X,d;return g.I(function(a){switch(a.C){case 1:return g.vv(a,2),p.C=new g.vi,p.T=!0,p.V=!1,g.y(a,p.J(),4);case 4:return g.y(a,p.C.promise,5);case 5:g.Fe(a,0);break;case 2:N=g.Sa(a),((X=(H=p).G)==null?0:X.call(H,"wo_relinquish_leadership_on_lock_request_error"))||p.DH(),N instanceof Error&&(d=N,d.args=[{name:"WoLockManagerError",Tx:N.name}],g.AG(d)),g.JQ(a)}})})}}},FGP=function(p){p.T&&(p.W=
!0,HK(p))},SE1=function(p,C){p.T&&(p.Y=C,HK(p))},KG0=function(p,C){p.T&&(p.D=C,HK(p))},HK=function(p){p.D&&p.Y&&p.W&&p.visibility.isBackground()?g.pg(p.S,6E4):p.S.stop()},Xh=function(p){var C;
p.offlineDeleteReason=(C=p.offlineDeleteReason)!=null?C:"OFFLINE_DELETE_REASON_UNKNOWN";var V;p.offlineModeType=(V=p.offlineModeType)!=null?V:"OFFLINE_NOW";g.h1("offlineDeleteEvent",p)},dQ=function(p,C){var V=C.videoId;
var N=C.Oh;C=C.offlineModeType;p.encryptedVideoId=V;p.cotn=N==null?void 0:N.cotn;p.offlineabilityFormatType=N==null?void 0:N.maximumDownloadQuality;var H;p.isRefresh=(H=N==null?void 0:N.isRefresh)!=null?H:!1;var X;p.softErrorCount=(X=N==null?void 0:N.transferRetryCount)!=null?X:0;p.offlineModeType=C!=null?C:"OFFLINE_NOW";(p.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&p.statusType==="UNKNOWN_STATUS_TYPE"||!p.transferStatusType&&!p.statusType)&&g.oW(Error("Woffle unknown transfer status"));
g.h1("offlineTransferStatusChanged",p)},DK8=function(p,C,V,N){N={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!N};C&&V&&(C=Math.floor(C/1024).toFixed(),V=Math.floor(V/1024).toFixed(),N.alreadyDownloadedKbytes=C,N.totalFetchedKbytes=C,N.totalContentKbytes=V);dQ(N,p)},ujP=function(p){dQ({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},p)},Z21=function(p){switch(p){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
il=function(p){var C,V,N;
return((N=(C=p.actionMetadata)==null?void 0:(V=C.retryScheduleIntervalsInSeconds)==null?void 0:V.length)!=null?N:0)>0},hg=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!p.entityKey},az=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!p.entityKey},Es=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!p.entityKey},UKP=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!p.entityKey},
ll=function(p,C,V,N,H){H=H===void 0?!1:H;
var X,d,a,E,l,t;return g.I(function(c){if(c.C==1)return X=g.d_(p,C),d=g.d_(p,"downloadStatusEntity"),g.y(c,gp(V,{mode:"readonly",L4:!0},function(T){return g.K3.all([RU(T,X,C),RU(T,d,"downloadStatusEntity")])}),2);
a=c.T;E=a.length?a[0]:void 0;if(!E)return c.EY(0);l=fof;if(t=a.length>1?a[1]:void 0){if(t.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!H)return c.return();t.downloadState=N}else t={key:d,downloadState:N};g.RW(E,l,t);return g.y(c,gp(V,{mode:"readwrite",L4:!0},function(T){return g.K3.all([P9(T,E,C),P9(T,t,"downloadStatusEntity")])}),0)})},tg=function(p,C){return p.actionType===C.actionType&&p.entityKey===C.entityKey},cK=function(p,C){if(p&&p.transferState!=="TRANSFER_STATE_COMPLETE"&&p.transferState!==
"TRANSFER_STATE_FAILED"){var V=g.Xq(p.key).entityId;
dQ({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:V,Oh:p,offlineModeType:C})}},TY=function(p){if(!p||!p.thumbnails)return[];
var C=[];p=g.F(p.thumbnails);for(var V=p.next();!V.done;V=p.next())V=V.value,V.url&&C.push(V.url);return C},O20=function(p,C,V){V=V===void 0?[]:V;
var N,H,X,d,a,E,l,t,c,T,M,J,S;return g.I(function(D){if(D.C==1)return V.length?g.y(D,rp(p,C),2):D.return([]);N=D.T;H=new Set;X=g.F(N);for(d=X.next();!d.done;d=X.next())if(a=d.value,E=a.id||a.key)l=g.Xq(E).entityId,H.add(l);t=[];c=g.F(V);for(T=c.next();!T.done;T=c.next())M=T.value,J=M.offlineVideoData,S=void 0,((S=J)==null?0:S.videoId)&&!H.has(J.videoId)&&t.push(M);return D.return(t)})},yxG=function(p,C,V){return new g.II(p,{cotn:C,
raw_player_response:V,download_media:!0,start:Infinity,disable_watch_next:!0})},qEP=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Mw=function(p,C,V,N,H,X,d,a,E,l,t){this.entityType=p;
this.actionId=C;this.action=V;this.parentActionId=N;this.rootActionId=H===void 0?C:H;this.childActionIds=X;this.prereqActionId=d;this.postreqActionIds=a;this.hasChildActionFailed=l;this.retryScheduleIndex=0;this.T=t||Date.now();this.retryScheduleIndex=E||0},Jg=function(p){if(!p.key)throw Error("Entity key is required.");
if(!p.actionProto)throw Error("OfflineOrchestrationAction is required.");var C=g.Xq(p.key),V=g.Xq(p.actionProto.entityKey);return new Mw(V.entityType,C.entityId,p.actionProto,p.parentActionId,p.rootActionId,p.childActionIds,p.prereqActionId,p.postreqActionIds,p.retryScheduleIndex,p.hasChildActionFailed,Number(p.enqueueTimeSec)*1E3)},vK=function(p){return{key:g.d_(p.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:p.action,parentActionId:p.parentActionId,rootActionId:p.rootActionId,childActionIds:p.childActionIds,prereqActionId:p.prereqActionId,postreqActionIds:p.postreqActionIds,retryScheduleIndex:p.retryScheduleIndex,hasChildActionFailed:p.hasChildActionFailed,enqueueTimeSec:(p.T/1E3).toFixed()}},Iop=function(){var p;
return g.I(function(C){return C.C==1?g.y(C,MhF(),2):(p=C.T)?C.return(p.delete("yt-player-local-img")):C.return(!0)})},Fh=function(p){var C,V;
return g.I(function(N){if(N.C==1)return g.y(N,MhF(),2);if(N.C!=3){C=N.T;if(!C)throw Error("Cache API not supported");return p.length?g.y(N,C.open("yt-player-local-img"),3):N.return()}V=N.T;return g.y(N,Promise.all(p.map(function(H){return V.delete(H)})),0)})},Sx=function(p){var C,V;
return g.I(function(N){if(N.C==1)return g.y(N,MhF(),2);if(N.C!=3){C=N.T;if(!C)throw Error("Cache API not supported");return p.length?g.y(N,C.open("yt-player-local-img"),3):N.return()}V=N.T;return g.y(N,V.addAll(p),0)})},K8=function(p,C,V,N,H){var X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,Y,W,L,VL,au,Q,e,G,m,P,p0,Sy,V8,fY,jy;
return g.I(function(Tp){switch(Tp.C){case 1:return X=g.d_(p,"mainVideoEntity"),d=g.d_(p,"ytMainChannelEntity"),a=g.d_(p,"transfer"),E=g.d_(p,"videoDownloadContextEntity"),g.y(Tp,gp(C,{mode:"readonly",L4:!0},function(r1){return g.K3.all([RU(r1,X,"mainVideoEntity"),RU(r1,d,"ytMainChannelEntity"),RU(r1,a,"transfer"),RU(r1,E,"videoDownloadContextEntity"),nC(r1,"ytMainChannelEntity"),nC(r1,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:l=Tp.T;t=g.F(l);c=t.next().value;T=t.next().value;M=t.next().value;J=t.next().value;S=t.next().value;D=t.next().value;Z=c;f=T;q=M;A=J;Y=S;W=D;if(!Z&&!f){Tp.EY(3);break}L=Z?TY(Z.thumbnail):[];if(!f){VL=[];Tp.EY(4);break}return g.y(Tp,b2f(f,Y),5);case 5:VL=Tp.T;case 4:return au=VL,g.y(Tp,Fh(L.concat(au)),3);case 3:Q=[];e=g.d_(p,"downloadStatusEntity");G=g.F(W);for(m=G.next();!m.done;m=G.next())P=m.value,p0=g.Xq(P.key).entityId,Sy=Jg(P),V8=g.Xq(Sy.action.entityKey).entityId,p0!==p&&V8!==p||tg(V,
P.actionProto)||Q.push(P.key);return g.y(Tp,gp(C,{mode:"readwrite",L4:!0},function(r1){var u=Q.map(function(U){return wp(r1,U)});
u.push(wp(r1,X,{Ar:!0}));u.push(wp(r1,e,{Ar:!0}));return g.K3.all(u)}),7);
case 7:jy=(fY=A)==null?void 0:fY.offlineModeType,H&&(Xh(H),H.offlineModeType&&(jy=H.offlineModeType)),cK(q,jy),Nw(N,{entityKey:X,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.JQ(Tp)}})},kuP=function(p,C,V,N){var H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,Y,W,L,VL,au,Q,e,G,m,P,p0,Sy,V8,fY,jy,Tp,r1,u,U,O,b,x,pY,d1,Hv,k,ES,my,i9,ou,iP,RF,cy;
return g.I(function($H){switch($H.C){case 1:return H=g.d_(p,"mainPlaylistEntity"),X=g.d_(p,"ytMainChannelEntity"),g.y($H,gp(C,{mode:"readonly",L4:!0},function(zt){return g.K3.all([RU(zt,H,"mainPlaylistEntity"),RU(zt,X,"ytMainChannelEntity"),nC(zt,"mainPlaylistEntity"),nC(zt,"mainDownloadsListEntity"),nC(zt,"ytMainChannelEntity"),nC(zt,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:d=$H.T;a=g.F(d);E=a.next().value;l=a.next().value;t=a.next().value;c=a.next().value;T=a.next().value;M=a.next().value;J=E;S=l;D=t;Z=c;f=T;q=M;if(!J&&!S){$H.EY(3);break}A=J?Axy(J):[];if(!S){Y=[];$H.EY(4);break}return g.y($H,b2f(S,f),5);case 5:Y=$H.T;case 4:return W=Y,g.y($H,Fh(A.concat(W)),3);case 3:L=[];VL=new Map;if(!J){$H.EY(7);break}return g.y($H,ooP(J,D,Z),8);case 8:L=$H.T;au=g.F(L);for(Q=au.next();!Q.done;Q=au.next())e=Q.value,VL.set(e,{videoId:e,playlistId:p,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.y($H,gp(C,{mode:"readonly",L4:!0},function(zt){return g.K3.all([nC(zt,"transfer"),nC(zt,"videoDownloadContextEntity")])}),9);
case 9:G=$H.T;m=g.F(G);P=m.next().value;p0=m.next().value;Sy=P;V8=p0;fY=g.F(Sy);for(jy=fY.next();!jy.done;jy=fY.next())Tp=jy.value,r1=g.Xq(Tp.key).entityId,(u=VL.get(r1))&&Tp&&(u.cotn=Tp.cotn);U=g.F(V8);for(O=U.next();!O.done;O=U.next())b=O.value,x=g.Xq(b.key).entityId,(pY=VL.get(x))&&b&&(pY.offlineModeType=b.offlineModeType);case 7:d1=[];Hv=g.F(q);for(k=Hv.next();!k.done;k=Hv.next())ES=k.value,my=g.Xq(ES.key).entityId,i9=Jg(ES),my!==p&&i9.rootActionId!==p||tg(V,ES.actionProto)||d1.push(ES.key);ou=
g.d_(p,"mainPlaylistEntity");return g.y($H,gp(C,{mode:"readwrite",L4:!0},function(zt){var El=d1.map(function(zA){return wp(zt,zA)});
El.push(wp(zt,ou,{Ar:!0}));return g.K3.all(El)}),10);
case 10:if(!J){$H.EY(0);break}L.reverse();if(!L){$H.EY(0);break}iP=g.F(L);RF=iP.next();case 13:if(RF.done){$H.EY(0);break}cy=RF.value;return g.y($H,K8(cy,C,V,N,VL.get(cy)),14);case 14:RF=iP.next(),$H.EY(13)}})},YE8=function(p,C,V,N){var H,X,d,a,E,l,t,c,T;
return g.I(function(M){if(M.C==1)return H=g.d_("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),X=new Map,g.y(M,gp(p,{mode:"readwrite",L4:!0},function(J){var S=nC(J,"transfer"),D=nC(J,"offlineOrchestrationActionWrapperEntity"),Z=nC(J,"videoDownloadContextEntity"),f=RU(J,H,"mainDownloadsListEntity");return g.K3.all([S,D,Z,f]).then(function(q){q=g.F(q);var A=q.next().value;var Y=q.next().value;var W=q.next().value;var L=q.next().value;q=xKv.map(function(au){return AU2(J,au)});
Y=g.F(Y);for(var VL=Y.next();!VL.done;VL=Y.next())VL=VL.value,tg(C,VL.actionProto)||q.push(wp(J,VL.key,{Ar:!0}));L&&(L.downloads=[],q.push(P9(J,L,"mainDownloadsListEntity")));if(W)for(W=g.F(W),L=W.next();!L.done;L=W.next())L=L.value,Y=g.Xq(L.key).entityId,Y=g.d_(Y,"transfer"),X.set(Y,L.offlineModeType);return g.K3.all(q).then(function(){return A})})}),2);
d=M.T;a=g.F(d);for(E=a.next();!E.done;E=a.next())l=E.value,cK(l,X.get(l.key)),t=g.Xq(l.key).entityId,c={videoId:t,offlineDeleteReason:N,cotn:l.cotn,offlineModeType:X.get(l.key)},Xh(c),T=g.d_(t,"mainVideoEntity"),Nw(V,{entityKey:T,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.y(M,Iop(),0)})},Axy=function(p,C){var V=[];
if(p.thumbnailStyleData){p=g.F(p.thumbnailStyleData);for(var N=p.next();!N.done;N=p.next()){var H=void 0,X=void 0,d=void 0;V=V.concat(TY((H=N.value)==null?void 0:(X=H.value)==null?void 0:(d=X.collageThumbnail)==null?void 0:d.coverThumbnail))}}C=TY(C);return V.concat(C)},ooP=function(p,C,V){var N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,Y,W,L,VL,au;
return g.I(function(Q){N=[];H=new Set;if(V.length)for(X=g.F(V),d=X.next();!d.done;d=X.next())if(a=d.value,E=void 0,(E=a.downloads)==null?0:E.length)for(l=g.F(a.downloads),t=l.next();!t.done;t=l.next())c=t.value,c.videoItem&&(T=g.Xq(c.videoItem).entityId,H.add(T));if(p.videos){M=g.F(p.videos);for(J=M.next();!J.done;J=M.next())S=J.value,D=JSON.parse(g.Xq(S).entityId),D.videoId&&!H.has(D.videoId)&&N.push(D.videoId);Z=g.F(C);for(f=Z.next();!f.done;f=Z.next())if(q=f.value,q.key!==p.key&&(A=q.videos))for(Y=
g.F(A),W=Y.next();!W.done;W=Y.next())L=W.value,VL=JSON.parse(g.Xq(L).entityId),VL.videoId&&(au=N.indexOf(VL.videoId),au!==-1&&N.splice(au,1))}return Q.return(N)})},b2f=function(p,C){var V,N,H,X,d,a,E,l;
return g.I(function(t){V=TY(p.avatar);N=g.F(C);for(H=N.next();!H.done;H=N.next())if(X=H.value,X.id!==p.id)for(d=g.F(TY(X.avatar)),a=d.next();!a.done;a=d.next())E=a.value,l=V.indexOf(E),l!==-1&&V.splice(l,1);return t.return(V)})},zUG=function(p){var C;
return g.I(function(V){C=g.n(p.frameworkUpdates,D2);return p.frameworkUpdates&&C?g.y(V,gc0(C),0):V.return()})},noY=function(p){var C;
if((C=p.onResponseReceivedActions)!=null&&C.length){var V;p=(V=g.n(g.n(p.onResponseReceivedActions[0],RUf),g.QF1))==null?void 0:V.actions;if(p!=null&&p.length)return p}},eUy=function(p){var C,V,N;
return g.I(function(H){if(H.C==1)return p?g.y(H,Qa(p,g.bS,"mainDownloadsListEntity"),2):H.return([]);C=H.T;return((V=C)==null?0:(N=V.downloads)==null?0:N.length)?H.return(C.downloads.map(function(X){var d;return(d=X.videoItem)!=null?d:""})):H.return([])})},wf2=function(p,C){var V;
return g.I(function(N){return N.C==1?g.y(N,P4E(p,C),2):(V=N.T)?g.y(N,gp(p,{mode:"readwrite",L4:!0},function(H){var X=[P9(H,V.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];V.mainDownloadsListEntity&&X.push(P9(H,V.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.K3.all(X)}),0):N.EY(0)})},P4E=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q;
return g.I(function(A){if(A.C==1)return V=g.d_("main_downloads_library_id","mainDownloadsLibraryEntity"),N=g.d_("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.y(A,gp(p,{mode:"readonly",L4:!0},function(Y){return g.K3.all([RU(Y,V,"mainDownloadsLibraryEntity"),RU(Y,N,"mainDownloadsListEntity")])}),2);
H=A.T;X=g.F(H);d=X.next().value;a=X.next().value;E=d;l=a;E||(E={id:V});t=g.F(C);for(c=t.next();!c.done;c=t.next())if(T=c.value,T===g.bS){if(E.smartDownloadsList)return A.return();E.smartDownloadsList=T}else if(M=g.Xq(T).entityType,J={},M==="mainPlaylistEntity"?J.playlistItem=T:M==="mainVideoEntity"&&(J.videoItem=T),!g.yW(J)){S=void 0;if((S=l)==null?0:S.downloads){D=!1;Z=g.F(l.downloads);for(f=Z.next();!f.done;f=Z.next())if(q=f.value,q.playlistItem===T||q.videoItem===T){D=!0;break}D||l.downloads.push(J)}else l=
{id:N,downloads:[J]};E.downloadsList=N}return A.return({mainDownloadsLibraryEntity:E,mainDownloadsListEntity:l})})},$K2=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D;
return g.I(function(Z){if(Z.C==1)return V=g.d_("main_downloads_library_id","mainDownloadsLibraryEntity"),N=g.d_("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.y(Z,gp(p,{mode:"readonly",L4:!0},function(f){return g.K3.all([RU(f,V,"mainDownloadsLibraryEntity"),RU(f,N,"mainDownloadsListEntity"),RU(f,g.bS,"mainDownloadsListEntity")])}),2);
H=Z.T;X=g.F(H);d=X.next().value;a=X.next().value;E=X.next().value;l=d;t=a;c=E;if(!l)return Z.EY(0);if(C===g.bS&&((T=c)==null?0:T.downloads))c.downloads=[];else if((M=t)==null?0:M.downloads)for(J=g.Xq(C).entityType,S=0;S<t.downloads.length;S++)if(D=t.downloads[S],J==="mainVideoEntity"&&D.videoItem===C){t.downloads.splice(S,1);break}else if(J==="mainPlaylistEntity"&&D.playlistItem===C){t.downloads.splice(S,1);break}return g.y(Z,gp(p,{mode:"readwrite",L4:!0},function(f){var q=[P9(f,l,"mainDownloadsLibraryEntity")];
t&&q.push(P9(f,t,"mainDownloadsListEntity"));c&&q.push(P9(f,c,"mainDownloadsListEntity"));return g.K3.all(q)}),0)})},ul=function(p,C){var V,N,H,X,d,a,E,l,t,c,T;
return g.I(function(M){if(M.C==1)return V=g.d_(C,"transfer"),N=g.d_(C,"videoDownloadContextEntity"),g.y(M,gp(p,{mode:"readonly",L4:!0},function(J){return g.K3.all([RU(J,V,"transfer"),RU(J,N,"videoDownloadContextEntity")])}),2);
H=M.T;X=g.F(H);d=X.next().value;a=X.next().value;E=d;l=a;T={videoId:C,cotn:(t=E)==null?void 0:t.cotn,offlineModeType:(c=l)==null?void 0:c.offlineModeType};return M.return(T)})},Z2=function(p,C,V,N,H){var X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,Y,W,L,VL;
return g.I(function(au){switch(au.C){case 1:return X=g.d_(p,"musicTrack"),d=g.d_(p,"transfer"),g.y(au,gp(C,{mode:"readonly",L4:!0},function(Q){return g.K3.all([RU(Q,X,"musicTrack"),RU(Q,d,"transfer"),nC(Q,"musicTrack"),nC(Q,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:a=au.T;E=g.F(a);l=E.next().value;t=E.next().value;c=E.next().value;T=E.next().value;M=l;J=t;S=c;D=T;if(!M){au.EY(3);break}return g.y(au,LGv(M,S),4);case 4:return Z=au.T,g.y(au,Fh(Z),3);case 3:f=[];q=g.F(D);for(A=q.next();!A.done;A=q.next())Y=A.value,W=g.Xq(Y.key).entityId,L=Jg(Y),VL=g.Xq(L.action.entityKey).entityId,W!==p&&VL!==p||tg(V,Y.actionProto)||f.push(Y.key);return g.y(au,gp(C,{mode:"readwrite",L4:!0},function(Q){var e=f.map(function(G){return wp(Q,G)});
e.push(wp(Q,X,{Ar:!0}));return g.K3.all(e)}),6);
case 6:cK(J),H&&Xh(H),Nw(N,{entityKey:X,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.JQ(au)}})},Us=function(p,C,V,N,H){var X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,Y,W,L,VL,au,Q,e,G,m,P,p0,Sy,V8,fY,jy,Tp,r1,u,U,O;
return g.I(function(b){switch(b.C){case 1:return X=g.d_(p,C),d=g.d_("music_downloads_library_id","musicDownloadsLibraryEntity"),g.y(b,gp(V,{mode:"readonly",L4:!0},function(x){return g.K3.all([RU(x,X,C),RU(x,d,"musicDownloadsLibraryEntity"),nC(x,C),nC(x,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:a=b.T;E=g.F(a);l=E.next().value;t=E.next().value;c=E.next().value;T=E.next().value;M=l;J=t;S=c;D=T;if(!M){b.EY(3);break}return g.y(b,LGv(M,S),4);case 4:return Z=b.T,g.y(b,Fh(Z),3);case 3:f=[];q=new Map;if(!M){b.EY(6);break}return g.y(b,goG(M,S,J),7);case 7:f=b.T;A=g.F(f);for(Y=A.next();!Y.done;Y=A.next())W=Y.value,L=g.Xq(W).entityId,q.set(L,{videoId:L,playlistId:p,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.y(b,rp(V,"transfer"),8);case 8:for(VL=b.T,au=g.F(VL),
Q=au.next();!Q.done;Q=au.next())e=Q.value,G=g.Xq(e.key).entityId,(m=q.get(G))&&e&&(m.cotn=e.cotn);case 6:P=[];p0=g.F(D);for(Sy=p0.next();!Sy.done;Sy=p0.next())V8=Sy.value,fY=g.Xq(V8.key).entityId,jy=Jg(V8),fY!==p&&jy.rootActionId!==p||tg(N,V8.actionProto)||P.push(V8.key);Tp=g.d_(p,C);return g.y(b,gp(V,{mode:"readwrite",L4:!0},function(x){var pY=P.map(function(d1){return wp(x,d1)});
pY.push(wp(x,Tp,{Ar:!0}));return g.K3.all(pY)}),9);
case 9:if(!M){b.EY(0);break}f.reverse();if(!f.length){b.EY(0);break}r1=g.F(f);u=r1.next();case 12:if(u.done){b.EY(0);break}U=u.value;O=g.Xq(U).entityId;if(!O){b.EY(13);break}return g.y(b,Z2(O,V,N,H,q.get(O)),13);case 13:u=r1.next(),b.EY(12)}})},f8=function(p,C,V){var N,H,X,d,a,E,l;
return g.I(function(t){if(t.C==1)return g.y(t,gp(p,{mode:"readwrite",L4:!0},function(c){var T=nC(c,"transfer"),M=nC(c,"offlineOrchestrationActionWrapperEntity");return g.K3.all([T,M]).then(function(J){J=g.F(J);var S=J.next().value;var D=J.next().value;J=WGf.map(function(A){return AU2(c,A)});
D=g.F(D);for(var Z=D.next();!Z.done;Z=D.next()){Z=Z.value;var f=g.Xq(Z.actionProto.entityKey).entityType==="musicTrack",q=Z.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";tg(C,Z.actionProto)||f&&(!f||q)||J.push(wp(c,Z.key,{Ar:!0}))}return g.K3.all(J).then(function(){return S})})}),2);
N=t.T;H=g.F(N);for(X=H.next();!X.done;X=H.next())d=X.value,cK(d),a=g.Xq(d.key).entityId,E={videoId:a,offlineDeleteReason:void 0,cotn:d.cotn},Xh(E),l=g.d_(a,"musicTrack"),Nw(V,{entityKey:l,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.y(t,Iop(),0)})},Q9p=function(p){for(var C,V=g.F(p.additionalMetadatas),N=V.next();!N.done;N=V.next())N=N.value,N.offlineMusicVideoData&&(C=N.offlineMusicVideoData);
var H,X,d,a,E;return{id:g.d_(p.videoId,"musicTrack"),videoId:p.videoId,title:p.title,thumbnailDetails:p.thumbnail,lengthMs:String(Number(p.lengthSeconds)*1E3),albumTitle:(H=C)==null?void 0:H.releaseTitle,musicVideoType:(X=C)==null?void 0:X.musicVideoType,contentRating:{explicitType:(d=C)==null?void 0:d.explicitType},artistNames:((a=C)==null?void 0:a.byline)||((E=C)==null?void 0:E.channelName),downloadMetadata:g.d_(p.videoId,"musicTrackDownloadMetadataEntity")}},goG=function(p,C,V){var N,H,X,d,a,E,
l,t,c,T,M,J,S,D,Z,f,q,A;
return g.I(function(Y){N=[];H=new Set;if((X=V)==null?0:(d=X.downloadedTracks)==null?0:d.length)for(a=g.F(V.downloadedTracks),E=a.next();!E.done;E=a.next())l=E.value,H.add(l);if(p.tracks){t=g.F(p.tracks);for(c=t.next();!c.done;c=t.next())T=c.value,H.has(T)||N.push(T);M=g.F(C);for(J=M.next();!J.done;J=M.next())if(S=J.value,S.id!==p.id&&(D=S.tracks))for(Z=g.F(D),f=Z.next();!f.done;f=Z.next())q=f.value,A=N.indexOf(q),A!==-1&&N.splice(A,1)}return Y.return(N)})},LGv=function(p,C){var V,N,H,X,d,a,E,l;
return g.I(function(t){V=TY(p.thumbnailDetails);N=g.F(C);for(H=N.next();!H.done;H=N.next())if(X=H.value,X.id!==p.id)for(d=g.F(TY(X.thumbnailDetails)),a=d.next();!a.done;a=d.next())E=a.value,l=V.indexOf(E),l!==-1&&V.splice(l,1);return t.return(V)})},rx2=function(p,C){var V,N,H,X,d,a,E,l,t;
return g.I(function(c){if(c.C==1)return V=g.d_("music_downloads_library_id","musicDownloadsLibraryEntity"),g.y(c,Qa(p,V,"musicDownloadsLibraryEntity"),2);(N=c.T)||(N={id:V});H=g.Xq(C).entityType;H==="musicTrack"?(X=N.downloadedTracks)!=null&&X.includes(C)||(N.downloadedTracks=((d=N.downloadedTracks)!=null?d:[]).concat(C)):H==="musicPlaylist"?(a=N.downloadedPlaylists)!=null&&a.includes(C)||(N.downloadedPlaylists=((E=N.downloadedPlaylists)!=null?E:[]).concat(C)):H!=="musicAlbumRelease"||(l=N.downloadedAlbumReleases)!=
null&&l.includes(C)||(N.downloadedAlbumReleases=((t=N.downloadedAlbumReleases)!=null?t:[]).concat(C));return g.y(c,W9(p,N,"musicDownloadsLibraryEntity"),0)})},B9p=function(p,C){var V,N,H,X,d,a,E;
return g.I(function(l){if(l.C==1)return V=g.d_("music_downloads_library_id","musicDownloadsLibraryEntity"),g.y(l,Qa(p,V,"musicDownloadsLibraryEntity"),2);N=l.T;if(!N)return l.EY(0);H=g.Xq(C).entityType;H==="musicTrack"?X=N.downloadedTracks:H==="musicPlaylist"&&(X=N.downloadedPlaylists);if((d=X)==null?0:d.length)for(a=0;a<X.length;a++)if(E=X[a],E===C){X.splice(a,1);break}return g.y(l,W9(p,N,"musicDownloadsLibraryEntity"),0)})},Gu5=function(p){var C=p.videos;
p=[];var V=[];if(C){C=g.F(C);for(var N=C.next();!N.done;N=C.next()){var H=N.value.offlineVideoData.videoId;N=g.d_(H,"musicTrack");H=g.d_(H,"musicTrackDownloadMetadataEntity");p.push(N);V.push(H)}}return{UN:p,tO:V}},Os=function(p,C,V){C={track:Q9p(C)};
V&&(C.playlistId=V);if(p=g.n(p.actionMetadata,ppr))C.maximumDownloadQuality=p.maximumDownloadQuality;return{musicTrackEntityActionMetadata:C}},j1f=function(p){var C,V,N,H,X,d,a,E;
return g.I(function(l){switch(l.C){case 1:return C=g.cH(),V=j9F(p),N=g.vh(Cfv),g.vv(l,2),X={LV:!0},g.y(l,g.NR(C,V,N,void 0,X),4);case 4:H=l.T;g.Fe(l,3);break;case 2:d=g.Sa(l);if(d instanceof g.E0)throw a="GetOffline network manager error: "+d.message,jx(a,d),Error(a);jx("GetOffline fetch request error",d);throw Error("GetOffline fetch request error");case 3:E=yZ(H);if(!H)throw jx("Network request failed"),Error("Network request failed");if(E!==void 0)qw(E);else if(!H.videos||!H.videos.length)throw jx("No data"),
Error("No data");return l.return(H.videos.map(function(t){return t.offlineVideoData}))}})},Vrr=function(p){var C,V,N,H,X,d,a,E;
return g.I(function(l){switch(l.C){case 1:return C=g.cH(),V=Vhy(p),N=g.vh(Cfv),g.vv(l,2),X={LV:!0},g.y(l,g.NR(C,V,N,void 0,X),4);case 4:H=l.T;g.Fe(l,3);break;case 2:d=g.Sa(l);if(d instanceof g.E0)throw a="GetOffline network manager error for playlist: "+d.message,jx(a,d),Error(a);jx("GetOffline fetch request error for playlist",d);throw Error("GetOffline fetch request error for playlist");case 3:E=yZ(H);if(!H)throw jx("Network request failed for playlist"),Error("Network request failed for playlist");
if(E!==void 0)qw(E,"playlist");else if(!H.playlists||!H.playlists.length)throw jx("No data for playlist"),Error("No data for playlist");return l.return(H.playlists.map(function(t){return t.offlinePlaylistData}))}})},Hor=function(p,C,V,N){var H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,Y,W,L,VL,au,Q,e,G,m,P,p0,Sy,V8;
return g.I(function(fY){switch(fY.C){case 1:return g.y(fY,B9(),2);case 2:H=fY.T;if(!H)return fY.return([]);X=[];if((d=N)==null?0:d.length){X=N;fY.EY(3);break}return g.y(fY,rp(H,"mainPlaylistEntity"),4);case 4:X=fY.T;case 3:if(!X.length)return fY.return([]);a=[];E=Date.now()/1E3;l=g.F(X);t=l.next();case 5:if(t.done)return a.length?g.y(fY,NxP(a),10):fY.return([]);c=t.value;if(!c.downloadState){T=void 0;fY.EY(8);break}return g.y(fY,Qa(H,c.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:T=
fY.T;case 8:M=T;J=void 0;D=(S=(J=c)==null?void 0:J.entityMetadata)&&S.nextAutoRefreshIntervalSeconds?Number(S.nextAutoRefreshIntervalSeconds):NaN;Z=Number.isNaN(D)?p:D;q=f=void 0;A=((f=M)==null?0:f.lastSyncedTimestampMillis)?Number((q=M)==null?void 0:q.lastSyncedTimestampMillis)/1E3:0;W=Y=void 0;L=((Y=M)==null?0:Y.addedTimestampMillis)?Number((W=M)==null?void 0:W.addedTimestampMillis)/1E3:0;if(V||!S||A+Z<=E){VL=[];au=void 0;if((au=c.videos)==null?0:au.length)for(Q=g.F(c.videos),e=Q.next();!e.done;e=
Q.next())G=e.value,m=JSON.parse(g.Xq(G).entityId),m.videoId&&VL.push(m.videoId);P="0";S&&(p0=void 0,P=String(Number((p0=S.offlineLastModifiedTimestampSeconds)!=null?p0:0).toFixed()));Sy={playlistId:c.playlistId,videoIds:VL,offlineLastModifiedTimestamp:P,autoSync:C,offlineDateAddedTimestamp:String(L.toFixed())};a.push(Sy)}t=l.next();fY.EY(5);break;case 10:return V8=fY.T,fY.return(V8)}})},XpG=function(){var p,C,V,N,H;
return g.I(function(X){if(X.C==1)return g.y(X,B9(),2);if(X.C!=3)return(p=X.T)?g.y(X,rp(p,"refresh"),3):X.return(!1);C=X.T;if((V=C[0])==null||!V.refreshTime)return X.return(!1);N=Number(C[0].refreshTime);H=Date.now()/1E3;return X.return(isFinite(N)&&H>=N)})},ioE=function(p,C){var V,N,H;
return g.I(function(X){switch(X.C){case 1:return g.vv(X,2),g.y(X,dZv(p,C),4);case 4:return N=X.T,g.y(X,zUG(N),5);case 5:V=noY(N);g.Fe(X,3);break;case 2:H=g.Sa(X),jx("getAndProcessSmartDownloadsResponse request or processing error",H);case 3:return X.return(V)}})},hz8=function(p,C,V,N){var H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,Y,W,L,VL,au,Q,e,G,m,P,p0,Sy,V8;
return g.I(function(fY){switch(fY.C){case 1:return g.y(fY,B9(),2);case 2:H=fY.T;if(!H)return fY.return([]);X=[];if((d=N)==null?0:d.length){X=N;fY.EY(3);break}return g.y(fY,rp(H,"musicPlaylist"),4);case 4:X=fY.T;case 3:if(!X.length)return fY.return([]);a=[];E=Date.now()/1E3;l=g.F(X);t=l.next();case 5:if(t.done)return a.length?g.y(fY,NxP(a),10):fY.return([]);c=t.value;T=void 0;J=(M=(T=c)==null?void 0:T.entityMetadata)&&M.nextAutoRefreshIntervalSeconds?Number(M.nextAutoRefreshIntervalSeconds):NaN;S=
Number.isNaN(J)?p:J;Z=D=0;f="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!c.downloadMetadata){fY.EY(8);break}return g.y(fY,Qa(H,c.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:q=fY.T,Y=A=void 0,D=Number((Y=(A=q)==null?void 0:A.addedTimestampMillis)!=null?Y:"0")/1E3,L=W=void 0,Z=Number((L=(W=q)==null?void 0:W.lastModifiedTimestampMillis)!=null?L:"0")/1E3,au=VL=void 0,f=(au=(VL=q)==null?void 0:VL.syncState)!=null?au:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:Q=void 0;if(V||f!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!M||Number((Q=M.lastSyncedTimestampSeconds)!=null?Q:0)+S<=E){e=[];G=void 0;if((G=c.tracks)==null?0:G.length)for(m=g.F(c.tracks),P=m.next();!P.done;P=m.next())p0=P.value,e.push(g.Xq(p0).entityId);Sy={playlistId:c.playlistId,videoIds:e,offlineLastModifiedTimestamp:String(Z.toFixed()),autoSync:C,offlineDateAddedTimestamp:String(D.toFixed())};a.push(Sy)}t=l.next();fY.EY(5);break;case 10:return V8=fY.T,fY.return(V8)}})},dZv=function(p,C){var V,N,H,X,d,a,E,l,t,c;
return g.I(function(T){switch(T.C){case 1:return V=g.cH(),g.y(T,B9(),2);case 2:N=T.T;if(!N){T.EY(3);break}return g.y(T,s9F(N),4);case 4:H=T.T;case 3:var M=H;X={context:g.MQ(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:p},offlineClientState:M,clientStateRequestData:{preferredFormatType:C}}}};d=g.vh(s1Y);g.vv(T,5);E={LV:!0};return g.y(T,g.NR(V,X,d,void 0,E),7);case 7:a=T.T;g.Fe(T,6);break;case 5:l=g.Sa(T);if(l instanceof g.E0)throw t=
"DPS network manager error for smart downloads: "+l.message,jx(t,l),Error(t);jx("DPS fetch request error for smart downloads",l);throw Error("DPS fetch request error for smart downloads");case 6:c=yZ(a);if(a)c!==void 0&&qw(c,"smart downloads");else throw jx("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return T.return(a)}})},ECP=function(p,C){var V,N,H,X,d,a,E,l;
return g.I(function(t){switch(t.C){case 1:return V=g.cH(),N={context:g.MQ(),videoPlaybackPositionEntities:p,lastSyncTimestampUsec:C},H=g.vh(aA1),g.vv(t,2),d={LV:!0},g.y(t,g.NR(V,N,H,void 0,d),4);case 4:X=t.T;g.Fe(t,3);break;case 2:a=g.Sa(t);if(a instanceof g.E0)throw E="VPPS network manager error: "+a.message,jx(E,a),Error(E);jx("VPPS fetch request error",a);throw Error("VPPS fetch request error");case 3:l=yZ(X);if(X)l!==void 0&&qw(l,"position sync");else throw jx("Network request failed for position sync"),
Error("Network request failed for position sync");return t.return(X)}})},trF=function(p,C,V){var N,H,X,d,a,E,l,t;
return g.I(function(c){switch(c.C){case 1:N=g.cH();var T=V.refreshData,M=V.isEnqueuedForExpiredStreamUrlRefetch,J=V.IS,S=V.offlineSourceData,D=V.mediaCapabilities,Z={entityKey:p};T&&(Z.refreshData=T);M&&(Z.isExpiredStreamUrlRefetch=M);J&&(Z.downloadParameters=J);S&&(Z.offlineSourceData=S);T={context:g.s5(C),signatureTimestamp:20096,videos:[Z]};D&&(T.mediaCapabilities=D);H=T;X=g.vh(lA0);g.vv(c,2);a={LV:!0};return g.y(c,g.NR(N,H,X,void 0,a),4);case 4:d=c.T;g.Fe(c,3);break;case 2:E=g.Sa(c);if(E instanceof
g.E0)throw l="GetPDE network manager error: "+E.message,jx(l,E),Error(l);jx("GetPDE fetch request error",E);throw Error("GetPDE fetch request error");case 3:t=yZ(d);if(d)t!==void 0&&qw(t,"PDE");else throw jx("Network request failed for PDE"),Error("Network request failed for PDE");return c.return(d)}})},yZ=function(p){var C;
return(C=p.errorMetadata)==null?void 0:C.status},qw=function(p,C){C=C?" for "+C:"";
if(p===0)throw p="Empty response body"+C,jx(p),Error(p);p="Response with error"+C;jx(p);throw Error(p);},NxP=function(p){var C,V,N,H,X,d,a,E;
return g.I(function(l){switch(l.C){case 1:return C=g.cH(),V=N9F(p),N=g.vh(cT2),g.vv(l,2),X={LV:!0},g.y(l,g.NR(C,V,N,void 0,X),4);case 4:H=l.T;g.Fe(l,3);break;case 2:d=g.Sa(l);if(d instanceof g.E0)throw a="offlinePlaylistSyncCheck network manager error: "+d.message,jx(a,d),Error(a);jx("offlinePlaylistSyncCheck fetch request error",d);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:E=yZ(H);if(!H)throw jx("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(E!==void 0)qw(E,"playlist sync");else if(!H.offlinePlaylistSyncCheckDatas||!H.offlinePlaylistSyncCheckDatas.length)throw jx("No data for playlist sync"),Error("No data for playlist sync");return l.return(H.offlinePlaylistSyncCheckDatas.map(function(t){return t.offlinePlaylistSyncCheckData}))}})},Iz=function(p){this.T=p},Tx0=function(p,C){var V,N,H,X,d,a;
return g.I(function(E){switch(E.C){case 1:V=new Map,N=g.F(C),H=N.next();case 2:if(H.done){E.EY(4);break}X=H.value;d=V;a=d.set;return g.y(E,p.C(X),5);case 5:a.call(d,X,E.T);H=N.next();E.EY(2);break;case 4:return E.return(V)}})},bl=function(p,C,V,N,H,X){C=g.d_(C,V);
N=Object.assign({},X,{priority:N,retryScheduleIntervalsInSeconds:H});return{actionType:p,entityKey:C,actionMetadata:N}},Ag=function(p,C,V,N,H,X){this.status=p;
this.T=C;this.S=V;this.C=N;this.V=H;this.downloadState=X},Mrc=function(p,C,V){this.T=p;
this.yn=C;this.V=V},vCr=function(p,C){var V,N,H,X,d,a,E,l,t;
return g.I(function(c){switch(c.C){case 1:return V=C.entityKey,H=(N=g.n(C.actionMetadata,oz))==null?void 0:N.isEnqueuedForExpiredStreamUrlRefetch,g.vv(c,2),X=void 0,g.y(c,JTP(p,C),4);case 4:X=c.T;g.vv(c,5);var T=(T=g.n(C.actionMetadata,oz))?{maximumDownloadQuality:T.maximumDownloadQuality}:void 0;return g.y(c,trF(V,p.yn,{isEnqueuedForExpiredStreamUrlRefetch:H,IS:T,offlineSourceData:X}),7);case 7:d=c.T;g.Fe(c,6,2);break;case 5:return g.Sa(c,2),a=il(C)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",jx("PDE handleAdd error"),c.return(kw(C,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",a,"DOWNLOAD_STATE_FAILED"));case 6:return g.y(c,mZp(p,d,C),8);case 8:return c.return(kw(C,!0,d.orchestrationActions));case 2:return E=g.Sa(c),l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.T4&&E.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),jx("PDE handleAdd error"),c.return(kw(C,!1,void 0,l,t,"DOWNLOAD_STATE_FAILED"))}})},KO5=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,Y,W,L,VL,au;
return g.I(function(Q){switch(Q.C){case 1:return V=C.entityKey,N=g.Xq(V).entityId,g.y(Q,gp(p.T,{mode:"readonly",L4:!0},function(e){var G=RU(e,V,"playbackData"),m=RU(e,g.d_(N,"offlineVideoPolicy"),"offlineVideoPolicy");e=RU(e,g.d_(N,"transfer"),"transfer");return g.K3.all([G,m,e])}),2);
case 2:H=Q.T;X=g.F(H);d=X.next().value;a=X.next().value;E=X.next().value;l=d;t=a;c=E;if(!l||!t)return Q.return(kw(C,!0));T=[];S=((J=l)==null?0:J.playerResponseJson)?JSON.parse(l.playerResponseJson):null;if(!(c&&S&&p.yn.G("html5_refresh_deprecated_downloads"))){Q.EY(3);break}M=FO0(p,S,c);return g.y(Q,SHc(p,c),4);case 4:T=Q.T;case 3:D={lastPlayerResponseTimestampSeconds:l.playerResponseTimestamp,offlineToken:t.offlineToken,formatIds:T};Z={};if((f=c)==null?0:f.maximumDownloadQuality)Z.maximumDownloadQuality=
c.maximumDownloadQuality;g.vv(Q,5);q=void 0;return g.y(Q,JTP(p,C),7);case 7:return q=Q.T,g.vv(Q,8),g.y(Q,trF(V,p.yn,{refreshData:D,IS:Z,offlineSourceData:q,mediaCapabilities:M}),10);case 10:A=Q.T;g.Fe(Q,9,5);break;case 8:return g.Sa(Q,5),Y=il(C)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",jx("PDE handleRefresh error"),Q.return(kw(C,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",Y,"DOWNLOAD_STATE_FAILED"));
case 9:return g.y(Q,mZp(p,A,C),11);case 11:return Q.return(kw(C,!0,A.orchestrationActions));case 5:return W=g.Sa(Q),L="PDE handleRefresh error",W instanceof Error&&(L="PDE handleRefresh error: "+W.message),VL="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",au="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W instanceof g.T4&&W.type==="QUOTA_EXCEEDED"&&(VL="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",au="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),jx(L),Q.return(kw(C,
!1,void 0,VL,au,"DOWNLOAD_STATE_FAILED"))}})},JTP=function(p,C){var V,N,H,X;
return g.I(function(d){if(d.C==1)return V=g.Xq(C.entityKey).entityId,N=g.d_(V,"videoDownloadContextEntity"),g.y(d,Qa(p.T,N,"videoDownloadContextEntity"),2);H=d.T;return(X=H)!=null&&X.offlineModeType?d.return({offlineModeType:H.offlineModeType}):d.return(void 0)})},mZp=function(p,C,V){var N,H,X,d,a;
return g.I(function(E){if(E.C==1){if(!C.frameworkUpdates||!g.n(C.frameworkUpdates,D2))return E.return();if(!(g.n(C.frameworkUpdates,D2).mutations&&g.n(C.frameworkUpdates,D2).mutations.length>0&&g.n(C.frameworkUpdates,D2).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return E.EY(2);N=g.Xq(g.n(C.frameworkUpdates,D2).mutations[0].entityKey).entityId;return g.y(E,ul(p.T,N),3)}if(E.C!=2){H=E.T;X=g.n(V.actionMetadata,oz);if(a=(d=X)==null?void 0:d.playlistId)H.playlistId=a;H.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.YS(p.yn)?g.y(E,K8(N,p.T,V,p.V,H),2):g.YU(p.yn)?g.y(E,Z2(N,p.T,V,p.V),2):E.EY(2)}return g.y(E,gc0(g.n(C.frameworkUpdates,D2)),0)})},kw=function(p,C,V,N,H,X){return new Ag(C?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",il(p),V,N,H,X)},FO0=function(p,C,V){C=yxG(p.yn,V.cotn,C);
V=g.H_(C);return g.Y6H(C,V,p.yn)},SHc=function(p,C){var V,N,H,X,d,a,E,l,t,c,T;
return g.I(function(M){if(M.C==1)return V=[],g.y(M,gp(p.T,{mode:"readonly",L4:!0},function(J){var S=[],D=C.offlineVideoStreams;if(D){D=g.F(D);for(var Z=D.next();!Z.done;Z=D.next())S.push(RU(J,Z.value,"offlineVideoStreams"))}return g.K3.all(S)}),2);
if(N=M.T)for(H=g.F(N),X=H.next();!X.done;X=H.next())if(d=X.value,a=void 0,(a=d)==null?0:a.streamsProgress)for(E=d.streamsProgress,l=0;l<E.length;l++)t=E[l],c=JSON.parse(t.formatStreamBytes),T={itag:c.itag,lmt:c.lastModified,xtags:c.xtags},V.push(T);return M.return(V)})},DZF=function(p,C){this.T=p;
this.yn=C},uUc=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M;
return g.I(function(J){switch(J.C){case 1:return V=il(C),g.y(J,rp(p.T,"videoPlaybackPositionEntity"),2);case 2:N=J.T;if(N.length===0)return J.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));g.vv(J,3);return g.y(J,x8.getInstance(),5);case 5:H=J.T;if(!H)throw Error("prefStorage is undefined");return g.y(J,H.get("psi"),6);case 6:return X=J.T,E=(a=(d=X)==null?void 0:d.Hy)!=null?a:"0",g.y(J,ECP(N,E),7);case 7:return l=J.T,t={isPaused:l.watchHistoryPaused,Hy:l.syncTimestampUsec},g.y(J,H.set("psi",
t),8);case 8:if(t.isPaused){J.EY(9);break}c=g.n(l.frameworkUpdates,D2);if(!l.frameworkUpdates||!c){J.EY(9);break}return g.y(J,gc0(c),9);case 9:g.Fe(J,4);break;case 3:return T=g.Sa(J),M="PPE handleRefresh error: "+(T instanceof Error?T.message:"unknown error"),jx(M),J.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return J.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},UZF=function(p,C){var V,N,H,X,d,a,E,l;
return g.I(function(t){switch(t.C){case 1:return V=il(C),N=g.Xq(C.entityKey).entityId,g.vv(t,2),g.y(t,x8.getInstance(),4);case 4:H=t.T;if(!H)throw Error("prefStorage is undefined");return g.y(t,H.get("psi"),5);case 5:X=t.T;d=g.n(C.actionMetadata,ZoG);if(((a=X)==null?void 0:a.isPaused)!==!1||(E=d)==null||!E.lastPlaybackPositionSeconds){t.EY(6);break}l={key:g.d_(N,"videoPlaybackPositionEntity"),videoId:N,lastPlaybackPositionSeconds:d.lastPlaybackPositionSeconds};return g.y(t,W9(p.T,l,"videoPlaybackPositionEntity"),
6);case 6:g.Fe(t,3);break;case 2:return g.Sa(t),t.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return t.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V))}})},fA0=function(p,C){var V,N,H;
return g.I(function(X){switch(X.C){case 1:V=il(C);g.vv(X,2);N=g.Xq(C.entityKey).entityId;if(N==="!*$_ALL_ENTITIES_!*$")return g.y(X,eu2(p.T),5);H=g.d_(N,"videoPlaybackPositionEntity");return g.y(X,nc8(p.T,H),5);case 5:g.Fe(X,3);break;case 2:return g.Sa(X),X.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return X.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},OoF=function(p,C){this.api=p;
this.T=C;this.logger=new g.E4("woffle");this.C=!1;this.VZ={X2:this.X2};this.logger.debug("Initialized OfflineMediaManager")},yT2=function(p){return g.I(function(C){return C.return(C41(p))})},qHv=function(p){var C;
return g.I(function(V){if(V.C==1)return g.y(V,g.QYX(p),2);C=V.T;return V.return(C.filter(function(N){return!!N.url}).map(function(N){return N.url}))})},xw=function(p,C){var V=g.JA(C);
if(V===1||V===0)return Promise.resolve();(V=IAG(p,C))&&V.stopVideo();p.V=0;return yT2(C)},Yw=function(p,C,V,N){V=V===void 0?!1:V;
N=N===void 0?!0:N;var H=typeof C==="string"?C:C.videoDetails.videoId;g.JA(H)===2&&((C=IAG(p,H))?C.stopVideo():p.logger.info(function(){return"Corresponding player for "+H+" not found. Pausing anyway"}),g.mx(H,2),p.V=2,V?boG(p.T):N&&AT5(p.T))},IAG=function(p,C){var V;
return((V=p.player)==null?void 0:V.getVideoData().videoId)===C?p.player:null},oC2=function(p,C,V){C.getPlayerResponse();
g.mx(C.videoId,2);p.V=2;p.C=!1;var N;(N=p.player)==null||N.dispose();p.player=p.api.Zk(9,C);C={};p.player.kQ((C.localmediachange=p.QG,C.signatureexpired=p.YD,C.statechange=p.JQe,C),p);var H=p.X2(V);p.player.nK(g.WY(H,H,!0,"m"),!1);p.logger.debug(function(){return"Starting headless playback with quality: "+H});
p.player.oA(!1)},k21=function(p,C){this.T=p;
this.yn=C},YHc=function(p,C){var V,N;
return g.I(function(H){switch(H.C){case 1:return V=il(C),g.y(H,Qa(p.T,C.entityKey,"transfer"),2);case 2:if(N=H.T)return H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));g.vv(H,3);return g.y(H,xZ8(p,C),5);case 5:g.Fe(H,4);break;case 3:return g.Sa(H),H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},zzf=function(p,C){var V,N;
return g.I(function(H){switch(H.C){case 1:return V=il(C),g.y(H,Qa(p.T,C.entityKey,"transfer"),2);case 2:N=H.T;if(!N||N.transferState!=="TRANSFER_STATE_COMPLETE")return H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));g.vv(H,3);return g.y(H,xZ8(p,C,!0),5);case 5:g.Fe(H,4);break;case 3:return g.Sa(H),H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V))}})},Rz1=function(p,C){var V,N,H,X,d,a,E,l,t,c;
return g.I(function(T){switch(T.C){case 1:return V=il(C),N=g.Xq(C.entityKey).entityId,g.y(T,gp(p.T,{mode:"readonly",L4:!0},function(M){var J=RU(M,C.entityKey,"transfer");M=RU(M,g.d_(N,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.K3.all([J,M])}),2);
case 2:H=T.T;X=g.F(H);d=X.next().value;a=X.next().value;E=d;l=a;if(!E||E.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return T.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));g.vv(T,3);E.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.y(T,W9(p.T,E,"transfer"),5);case 5:t=g.Xq(E.key).entityId;dQ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:t,Oh:E,offlineModeType:(c=l)==null?void 0:c.offlineModeType});g.Fe(T,
4);break;case 3:return g.Sa(T),T.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return T.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V))}})},xZ8=function(p,C,V){V=V===void 0?!1:V;
var N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z;return g.I(function(f){switch(f.C){case 1:return N=g.n(C.actionMetadata,nC1),H=g.Xq(C.entityKey).entityId,X=g.d_(H,"downloadStatusEntity"),g.y(f,gp(p.T,{mode:"readonly",L4:!0},function(q){var A=RU(q,X,"downloadStatusEntity");q=RU(q,g.d_(H,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.K3.all([A,q])}),2);
case 2:return d=f.T,a=g.F(d),E=a.next().value,l=a.next().value,t=E,c=l,T="TRANSFER_STATE_TRANSFER_IN_QUEUE",((M=t)==null?void 0:M.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(T="TRANSFER_STATE_PAUSED_BY_USER"),D={key:C.entityKey,transferState:T,cotn:g.D9(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(J=N)==null?void 0:J.maximumDownloadQuality,preferredAudioTrack:(S=N)==null?void 0:S.preferredAudioTrack,transferRetryCount:0,isRefresh:V,hasLoggedFirstStarted:!1},g.y(f,gp(p.T,
{mode:"readwrite",L4:!0},function(q){var A=[];V&&A.push(wp(q,g.d_(H,"offlineVideoStreams")));A.push(P9(q,D,"transfer"));return g.K3.all(A)}),3);
case 3:if(!V){f.EY(4);break}return g.y(f,yT2(H),4);case 4:dQ({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:H,Oh:D,offlineModeType:(Z=c)==null?void 0:Z.offlineModeType}),g.JQ(f)}})},Pf2=function(p,C,V,N){if(!p.action.entityKey)throw Error("entityKey is missing.");
var H=g.Xq(p.action.entityKey);H={entityType:H.At,entityId:H.entityId,offlineOrchestrationActionType:p.action.actionType,orchestrationAction:{orchestrationActionId:p.actionId}};C&&(H.offlineOrchestrationActionResult=C.status,H.isRetryable=V?!1:C.T,C.V&&(H.offlineOrchestrationFailureReason=ez1(C.V,H.isRetryable)));var X,d;if((X=p.action.actionMetadata)==null?0:(d=X.offlineLoggingData)==null?0:d.offlineModeType)H.offlineModeType=p.action.actionMetadata.offlineLoggingData.offlineModeType;N&&(H.additionalOrchestrationActions=
N.map(function(a){return{orchestrationActionId:a.actionId}}));
return H},ez1=function(p,C){return p!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||C?p==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&C?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":p:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},wpv=function(p,C){var V={offlineOrchestrationContext:Pf2(p)};
C=i2G(C,V);hUc(dKp(),C,p.rootActionId)},$ZE=function(p,C,V,N){N=N===void 0?[]:N;
C={offlineOrchestrationContext:Pf2(p,C,V,N)};C=i2G(3,C);hUc(dKp(),C,p.rootActionId)},LOy=function(){this.actions=[]},gCf=function(p,C){C=g.F(C);
for(var V=C.next();!V.done;V=C.next())V=V.value,wpv(V,1),p.actions.push(V);p.actions.sort(p.T)},WOE=function(p,C){if(C)for(var V=0;V<p.actions.length;V++)if(C==="!*$_ALL_ENTITIES_!*$"&&p.actions[V].actionId!==C||C!=="!*$_ALL_ENTITIES_!*$"&&p.actions[V].rootActionId===C&&p.actions[V].actionId!==C)p.actions.splice(V,1),V--},Q11=function(p,C){p=g.F(p.actions);
for(var V=p.next();!V.done;V=p.next())if(V.value.actionId===C)return!0;return!1},zY=function(p,C,V,N,H){g.z.call(this);
var X=this;this.C=p;this.sY=C;this.a$=V;this.D=N;this.yn=H;this.T=new LOy;this.Y=new g.p1;this.V=new g.Go(function(){X.retry()});
this.J=NaN;this.W=!1;this.VZ={r6Y:function(){return X.T},
w4:function(){return X.Y},
mSo:function(){return X.V},
retry:function(){return X.retry()}};
g.R(this,this.V);this.Z=this.C.observe(this.b_.bind(this))},G2v=function(p,C,V,N,H){var X;
return g.I(function(d){if(d.C==1)return X=new zY(p,C,V,N,H),g.y(d,rT8(X),2);Bxy(X);return d.return(X)})},Bxy=function(p){var C=p.T.actions[0];
return p.S?((C==null?void 0:C.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&p.S[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(p.W=!0),Promise.resolve()):poc(p)},poc=function(p){var C,V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z;
return g.I(function(f){switch(f.C){case 1:if(p.S)throw Error("Already processing an action");if(p.fS())return f.return();C=p.T.actions.shift();SE1(p.a$,!C);if(C===void 0)return f.return();C.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&C.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&WOE(p.T,C.actionId);V="";C.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&C.rootActionId===C.actionId&&(V=C.actionId);N=[C];p.S=N;if(H=p.sY[C.entityType]){f.EY(2);break}p.S=
void 0;return g.y(f,poc(p),3);case 3:return f.return();case 2:X=g.F(N);for(d=X.next();!d.done;d=X.next())a=d.value,wpv(a,2);g.vv(f,4,5);return g.y(f,Tx0(H,N.map(function(q){return q.action})),7);
case 7:E=f.T,l=g.F(N),t=l.next();case 8:if(t.done){f.EY(10);break}c=t.value;T=E.get(c.action);return g.y(f,Cu1(p,c,T),9);case 9:t=l.next();f.EY(8);break;case 10:WOE(p.T,V);case 5:g.KY(f);p.S=void 0;g.Dj(f,6);break;case 4:return M=g.Sa(f),jx("Orchestration error",M),g.vv(f,12),g.y(f,jq5(p,N),14);case 14:g.Fe(f,5);break;case 12:J=g.Sa(f);jx("Orchestration retry error",J);S=g.F(N);for(D=S.next();!D.done;D=S.next())Z=D.value,Z.retryScheduleIndex<3&&gCf(p.T,[Z]);f.EY(5);break;case 6:return g.y(f,poc(p),
0)}})},Cu1=function(p,C,V){var N,H,X,d,a,E,l,t,c,T,M,J;
return g.I(function(S){switch(S.C){case 1:N=C.retryScheduleIndex+2===3;if(V.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){S.EY(2);break}if(V.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){S.EY(0);break}$ZE(C,V,N);if(V.T&&C.retryScheduleIndex+1<3)return g.y(S,jq5(p,[C]),0);X=((H=V)==null?0:H.C)?V.C:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";d={entityKey:C.action.entityKey,failureReason:X};a=void 0;g.YS(p.yn)?a="mainVideoDownloadStateEntity":g.YU(p.yn)&&(a="musicTrackDownloadMetadataEntity");
if(!a||!V.downloadState){S.EY(7);break}E=g.Xq(C.action.entityKey).entityId;return g.y(S,ll(E,a,p.C,V.downloadState),7);case 7:Nw(p.D,d);if(V.downloadState==="DOWNLOAD_STATE_FAILED"&&p.yn.G("html5_auto_retry_failed_pde_actions")){S.EY(0);break}jx("Orchestration result is not retryable, deleting action");return g.y(S,nc8(p.C,vK(C).key),0);case 2:l=void 0;try{l=(t=V.S)==null?void 0:t.map(function(D){return p.createAction(D,C)})}catch(D){return $ZE(C,V,N),c={entityKey:C.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},Nw(p.D,c),jx("Orchestration subactions creation error",D),S.return()}$ZE(C,V,N,l);if(!l){S.EY(12);break}T=l.map(function(D){return vK(D)});
M=0;case 13:if(!(M<l.length)||p.W){S.EY(15);break}return g.y(S,gp(p.C,{mode:"readwrite",L4:!0},function(D){var Z=[];Z.push(qhr(D,T.slice(M,M+10),"offlineOrchestrationActionWrapperEntity"));return g.K3.all(Z)}),16);
case 16:M+=10;S.EY(13);break;case 15:if(p.W)return p.W=!1,S.return();case 12:return J=vK(C),g.y(S,nc8(p.C,J.key),17);case 17:wpv(C,4),g.JQ(S)}})},Xop=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M;
return g.I(function(J){V=[];N=Infinity;H=4E3;X=g.F(C);for(d=X.next();!d.done;d=X.next())a=d.value,E=Number(a.enqueueTimeSec),l=V0y(E),t=a.retryScheduleIndex,c=t!=null&&t>0,l>0&&c?(N=Math.min(N,E),H=Math.min(l,H)):V.push(a);isFinite(N)&&(!p.V.isActive()||N<p.J)&&(p.J=N,p.V.start(H));p.Y.xq()||(T=V.length,V=V.filter(function(S){var D;S=((D=S.actionProto)==null?void 0:D.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!NEY.includes(S)}),M=V.length<T,!p.V.isActive()&&M&&p.V.start(1));
V.length>0&&HX2(p,V);return g.y(J,Bxy(p),0)})},iXr=function(p){var C,V,N,H,X,d,a;
return g.I(function(E){if(E.C==1)return g.y(E,dPP(p),2);C=E.T;V=[];N=g.F(C);for(H=N.next();!H.done;H=N.next())X=H.value,d=g.Xq(X.key),a=d.entityId,Q11(p.T,a)||V.push(X);return g.y(E,Xop(p,V),0)})},V0y=function(p){p=p*1E3-Date.now();
return p>4E3?4E3:p},jq5=function(p,C){var V,N,H;
return g.I(function(X){V=g.F(C);for(N=V.next();!N.done;N=V.next()){H=N.value;var d=void 0,a=void 0,E=((a=H.action)==null?void 0:(d=a.actionMetadata)==null?void 0:d.retryScheduleIntervalsInSeconds)||[1,2,4];d=1;H.retryScheduleIndex<E.length&&(d=E[H.retryScheduleIndex]);H.T=d*1E3+Date.now();H.retryScheduleIndex++}return g.y(X,hF8(p,C),0)})},rT8=function(p){var C;
return g.I(function(V){if(V.C==1)return g.y(V,rp(p.C,"offlineOrchestrationActionWrapperEntity"),2);C=V.T;return g.y(V,Xop(p,C),0)})},HX2=function(p,C){C.length!==0&&C.forEach(function(V){V=Jg(V);
V.retryScheduleIndex<3&&gCf(p.T,[V])})},dPP=function(p,C){var V;
return g.I(function(N){if(N.C==1)return g.y(N,rp(p.C,"offlineOrchestrationActionWrapperEntity",C),2);V=N.T;return N.return(V.filter(Wg2))})},hF8=function(p,C){if(C.length===0)return Promise.resolve([]);
C=C.map(function(V){return vK(V)});
return Ru0(p.C,C)},sqy=function(p){this.ea=p;
this.T=void 0},aKy=function(p,C){var V,N,H,X;
return g.I(function(d){V=C.videoId;N=!0;if(C.captionTracks.length)H=Itc(C),p.T=new g.oT(p.ea,C,H);else if(C.f9)X=g.tov(C),p.T=new g.xW(p.ea,C.f9,V,X,C.c_,C.eventId),N=C.c_;else return d.return();return d.return(new Promise(function(a){var E;(E=p.T)==null||E.Wn({N3:function(){return g.I(function(l){if(l.C==1)return g.y(l,p.N3(V,N),2);a();g.JQ(l)})},
eY:function(){}})}))})},EI1=function(p){var C;
return g.I(function(V){if(V.C==1)return g.y(V,pfF(p),2);C=V.T;return V.return(!!C&&C.length>0)})},Rz=function(p){g.z.call(this);
this.T=p;this.C=this.T.observe(this.V.bind(this))},lKY=function(p,C){var V,N,H,X,d,a,E;
return g.I(function(l){switch(l.C){case 1:if(C.length===0)return l.return([]);V=C.map(function(t){return g.d_(t,"transfer")});
return g.y(l,rp(p.T,"transfer",V),2);case 2:N=l.T;H=N.filter(Wg2).map(function(t){return g.Xq(t.key).entityId});
X=C.filter(function(t){return H.indexOf(t)===-1});
if(X.length===0)return l.return([]);d=g.F(X);a=d.next();case 3:if(a.done){l.EY(5);break}E=a.value;return g.y(l,yT2(E),4);case 4:a=d.next();l.EY(3);break;case 5:return l.return(X)}})},TE2=function(p,C,V,N,H,X){var d,a,E;
return g.I(function(l){d="STREAM_TYPE_UNKNOWN";V.video&&V.audio?(d="STREAM_TYPE_AUDIO_AND_VIDEO",jx("unexpected stream type")):V.video&&!V.audio?d="STREAM_TYPE_VIDEO":!V.video&&V.audio&&(d="STREAM_TYPE_AUDIO");a=g.d_(C,"offlineVideoStreams");E={numBytesDownloaded:H.toFixed(),numTotalBytes:X.toFixed(),streamType:d,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(N),itag:d==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(V.itag):void 0};return g.y(l,gp(p,{mode:"readwrite",L4:!0},
function(t){var c=RU(t,a,"offlineVideoStreams"),T=RU(t,g.d_(C,"transfer"),"transfer");return g.K3.all([c,T]).then(function(M){M=g.F(M);var J=M.next().value;M=M.next().value;if(!M)return wp(t,a).then(function(){});
var S=t0r(J);J=cCr(J,N,E,a);var D=P9(t,J,"offlineVideoStreams");t0r(J)>S&&(M.lastProgressTimeMs=Date.now().toString());S=[D];M.offlineVideoStreams||(M.offlineVideoStreams=[]);M.offlineVideoStreams.indexOf(a)===-1&&(M.offlineVideoStreams.push(a),S.push(P9(t,M,"transfer")));return g.K3.all(S)})}),0)})},M0v=function(p,C){var V,N,H,X,d;
return g.I(function(a){if(a.C==1)return V=g.d_(C,"offlineVideoStreams"),g.y(a,Qa(p,V,"offlineVideoStreams"),2);N=a.T;if(!N||!N.streamsProgress)return a.return();H=g.F(N.streamsProgress);for(X=H.next();!X.done;X=H.next())d=X.value,d.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",d.numTotalBytes!==d.numBytesDownloaded&&(d.numBytesDownloaded=d.numTotalBytes);return g.y(a,W9(p,N,"offlineVideoStreams"),0)})},cCr=function(p,C,V,N){if(p&&p.streamsProgress){N=p;
a:{C=C.itag+";"+C.xtags;for(var H=p.streamsProgress,X=0;X<H.length;X++){var d=JSON.parse(H[X].formatStreamBytes);if(d.itag+";"+d.xtags===C){H[X]=V;V=H;break a}}H.push(V);V=H}N.streamsProgress=V}else p={key:N,streamsProgress:[V]};return p},t0r=function(p){if(p==null?0:p.streamsProgress){var C=0;
p=p.streamsProgress;for(var V=0;V<p.length;V++){var N=p[V];isNaN(Number(N.numBytesDownloaded))?jx("stream progress bytes number invalid"):C+=Number(N.numBytesDownloaded)}return C}return 0},JCG=function(p,C,V,N){g.z.call(this);
var H=this;this.C=p;this.api=C;this.R$=V;this.b_=N;this.Y=new g.p1;this.S=new g.Go(function(){H.T&&H.T.transferState==="TRANSFER_STATE_TRANSFERRING"&&H.Y.xq()&&((H.T.transferRetryCount||0)<3?Yw(H.D,H.W,!1,!1):xw(H.D,H.W.videoDetails.videoId),H.Xb("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.a$=this.Sa=0;this.Z=this.J=!1;this.Y_=g.a3(this.api.K().experiments,"html5_transfer_processing_logs_interval");this.Ga=new g.Ir(this);this.VZ={Whr:function(){return H.S},
aJY:function(){return H.b_},
w4:function(){return H.Y}};
this.sY=this.C.observe(this.R7.bind(this));this.D=new OoF(C,this);this.l_=new sqy(C);this.Vn=new Rz(this.C);this.vr=this.Y.listen("publicytnetworkstatus-online",this.wf.bind(this));this.Wr=this.Y.listen("publicytnetworkstatus-offline",this.qOo.bind(this));this.Z=this.api.K().G("html5_less_transfer_processing_logs");g.R(this,this.Ga);this.Ga.U(C,"offlinetransferpause",this.cia);g.YS(this.api.K())?this.V="mainVideoDownloadStateEntity":g.YU(this.api.K())&&(this.V="musicTrackDownloadMetadataEntity")},
mP2=function(p){return g.I(function(C){if(C.C==1)C=g.y(C,BT0(),2);
else{var V=p.Vn;var N=g.MF();N=Object.keys(N);V=lKY(V,N);C=g.y(C,V,0)}return C})},ex=function(p,C){C=C===void 0?!1:C;
var V;return g.I(function(N){if(N.C==1){if(p.T)throw Error("Already downloading a video");p.a$=0;p.J=!1;return g.y(N,vIp(p),2)}return N.C!=4?(V=N.T,KG0(p.R$,!V),V&&p.Y.xq()?C?g.y(N,new Promise(function(H){g.TQ(H,1E3)}),4):N.EY(4):(!V&&p.T&&n8(p),N.EY(0))):g.y(N,FVy(p,V),0)})},SMr=function(p){return g.I(function(C){if(C.C==1)return p.W?g.y(C,xw(p.D,p.W.videoDetails.videoId),3):C.EY(0);
n8(p);g.JQ(C)})},KV8=function(p,C){var V,N,H;
return g.I(function(X){switch(X.C){case 1:return g.vv(X,2),(V=!!C.captionTracks.length||!!C.f9)?g.y(X,EI1(C.videoId),4):X.return();case 4:return(N=X.T)?X.return():g.y(X,aKy(p.l_,C),5);case 5:g.Fe(X,0);break;case 2:H=g.Sa(X),jx("Caption downloading error",H,C.cotn),g.JQ(X)}})},FVy=function(p,C){var V,N,H,X,d,a;
return g.I(function(E){switch(E.C){case 1:if(p.J)return E.return();p.J=!0;p.T=C;V=g.Xq(p.T.key);N=V.entityId;H=void 0;if(p.T.transferState==="TRANSFER_STATE_TRANSFERRING")return g.y(E,PK(p,N),7);if(p.T.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||p.T.transferRetryCount||p.T.hasLoggedFirstStarted){E.EY(3);break}return g.y(E,PK(p,N),5);case 5:return H=E.T,p.T.hasLoggedFirstStarted=!0,g.y(E,DPv(p),6);case 6:DK8({videoId:N,Oh:p.T,offlineModeType:H},void 0,void 0,!0);E.EY(3);break;case 7:H=E.T,
dQ({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:N,Oh:p.T,offlineModeType:H});case 3:return g.y(E,ulF(p),8);case 8:return X=null,g.vv(E,9),g.y(E,ZXG(p,C),11);case 11:X=E.T;p.W=X;g.Fe(E,10);break;case 9:return d=g.Sa(E),jx("error getting player response",d,C.cotn),g.y(E,p.Xb("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return E.return();case 10:return a=yxG(p.api.K(),C.cotn,X),g.y(E,KV8(p,a),13);case 13:return g.y(E,qHv(a.videoId),
14);case 14:a.SA=E.T,oC2(p.D,a,C.maximumDownloadQuality),p.S.start(108E5),g.JQ(E)}})},vIp=function(p){var C,V;
return g.I(function(N){if(N.C==1)return g.y(N,rp(p.C,"transfer"),2);C=N.T;V=C.filter(UP5).sort(fKc);return V.length===0?N.return():N.return(V[0])})},ulF=function(p){var C,V,N;
return g.I(function(H){if(H.C==1){if(!p.T)return wQ(p,"onTransferStart"),H.return();p.S.start(108E5);return g.y(H,$w(p,"TRANSFER_STATE_TRANSFERRING"),2)}C=p.T;return(N=((V=C)==null?0:V.key)?g.Xq(C.key).entityId:"")&&p.V?g.y(H,ll(N,p.V,p.C,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):H.EY(0)})},boG=function(p){var C,V,N,H;
g.I(function(X){switch(X.C){case 1:if(!p.T){wQ(p,"onTransferPausedByUser");X.EY(2);break}C=p.T;p.S.stop();return g.y(X,$w(p,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:N=((V=C)==null?0:V.key)?g.Xq(C.key).entityId:"";if(!N||!p.V){X.EY(4);break}return g.y(X,ll(N,p.V,p.C,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.y(X,PK(p,N),6);case 6:H=X.T,ujP({videoId:N,Oh:C,offlineModeType:H});case 2:n8(p),ex(p),g.JQ(X)}})},AT5=function(p){var C,V,N;
g.I(function(H){if(H.C==1){if(!p.T)return wQ(p,"onTransferPausedByNetwork"),H.return();p.S.stop();return g.y(H,$w(p,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(H.C!=3)return C=p.T,(N=((V=C)==null?0:V.key)?g.Xq(C.key).entityId:"")&&p.V?g.y(H,ll(N,p.V,p.C,"DOWNLOAD_STATE_PAUSED"),3):H.EY(3);n8(p);g.JQ(H)})},OX2=function(p){var C,V,N,H,X;
g.I(function(d){switch(d.C){case 1:if(!p.T)return wQ(p,"onTransferComplete"),d.return();C=p.T;p.S.stop();if(!C||!p.W){d.EY(2);break}V=yxG(p.api.K(),C.cotn,p.W);return g.y(d,KV8(p,V),2);case 2:return g.y(d,$w(p,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:H=((N=C)==null?0:N.key)?g.Xq(C.key).entityId:"";if(!H||!p.V){d.EY(5);break}return g.y(d,ll(H,p.V,p.C,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.y(d,M0v(p.C,H),7);case 7:return g.y(d,PK(p,H),8);case 8:X=d.T,dQ({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:H,Oh:C,offlineModeType:X}),n8(p),ex(p),g.JQ(d)}})},yCG=function(p,C,V){var N,H;
g.I(function(X){switch(X.C){case 1:if(!p.T)return wQ(p,"onTransferProgress: "+C),X.return();if(p.T.transferState==="TRANSFER_STATE_TRANSFERRING"){X.EY(2);break}return g.y(X,ulF(p),2);case 2:N=Date.now();if(!(N-p.Sa>1E3)){X.EY(4);break}p.Sa=N;return g.y(X,TE2(p.C,V.videoId,V.C,V.Yw,V.bytesDownloaded,V.T),5);case 5:if(p.Z&&!(p.Z&&N-p.a$>p.Y_)){X.EY(4);break}p.a$=N;return g.y(X,PK(p,C),7);case 7:H=X.T,DK8({videoId:C,Oh:p.T,offlineModeType:H},V.bytesDownloaded,V.T);case 4:p.S.start(108E5),g.JQ(X)}})},
qME=function(p){var C=(p.T.transferRetryCount||0)<3;
C&&(p=p.T,p.transferRetryCount=(p.transferRetryCount||0)+1);return C},IK2=function(p,C){C=C===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":C;
var V,N,H,X;return g.I(function(d){if(d.C==1)return p.T||wQ(p,"setTransferToFailed: "+C),V="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C==="TRANSFER_FAILURE_REASON_NETWORK"?V="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":C==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(V="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.y(d,$w(p,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",C),2);if(d.C!=3)return Nw(p.b_,{entityKey:(N=p.T)==null?void 0:N.key,failureReason:V}),
H=p.T?g.Xq(p.T.key).entityId:"",g.y(d,PK(p,H),3);X=d.T;var a={videoId:H,Oh:p.T,offlineModeType:X},E=C,l={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};E&&(l.transferFailureReason=E,l.failureReason=Z21(E));dQ(l,a);g.JQ(d)})},$w=function(p,C,V,N){var H;
return g.I(function(X){if(X.C==1){if(!p.T)return wQ(p,"saveTransferState: "+C),X.return();p.T.transferState=C;p.T.failureReason=N;g.vv(X,2);return g.y(X,DPv(p,function(d){return V?nC(d,"offlineVideoStreams",p.T.offlineVideoStreams).then(function(a){for(var E=g.F(a),l=E.next();!l.done;l=E.next())if((l=l.value)&&l.streamsProgress){l=g.F(l.streamsProgress);for(var t=l.next();!t.done;t=l.next())t.value.streamState=V}return qhr(d,a.filter(function(c){return!!c}),"offlineVideoStreams")}):g.K3.resolve(void 0)}),
4)}if(X.C!=2)return g.Fe(X,0);
H=g.Sa(X);return H instanceof g.T4&&H.type==="QUOTA_EXCEEDED"?g.y(X,p.Xb("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):X.EY(0)})},DPv=function(p,C){var V;
return g.I(function(N){if(!p.T)return N.return();V=p.T;return g.y(N,gp(p.C,{mode:"readwrite",L4:!0},function(H){var X=[P9(H,V,"transfer")];C&&X.push(C(H));return g.K3.all(X)}),0)})},n8=function(p){p.T=void 0;
p.W=void 0;p.S.stop()},ZXG=function(p,C){var V,N,H,X,d;
return g.I(function(a){if(a.C==1)return V=g.Xq(C.key),N=V.entityId,H=g.d_(N,"playbackData"),g.y(a,Qa(p.C,H,"playbackData"),2);X=a.T;if((d=X)==null?0:d.playerResponseJson)return a.return(JSON.parse(X.playerResponseJson));throw Error("No PlayerResponse found");})},wQ=function(p,C){p.api.k_("woffle",{mcte:C});
jx("missing current transfer entity.")},PK=function(p,C){var V,N,H;
return g.I(function(X){if(X.C==1)return g.y(X,Qa(p.C,g.d_(C,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);V=X.T;return X.return((H=(N=V)==null?void 0:N.offlineModeType)!=null?H:void 0)})},UP5=function(p){return bX0[p.transferState]!==void 0},fKc=function(p,C){var V=bX0[p.transferState],N=bX0[C.transferState];
return V!==N?V-N:Number(p.enqueuedTimestampMs)-Number(C.enqueuedTimestampMs)},L8=function(p,C){var V=this;
this.yn=p;this.api=C;this.Y=new g.p1;this.W=new g.vi;this.VZ={Oe:function(){return V.V.VZ.Oe()},
w4:function(){return V.Y},
bVo:function(){return V.V},
xo:function(){return V.xo()},
F1:function(){return V.F1()},
ZB:function(){return V.ZB()},
aJ:function(){return V.aJ()},
y7:function(){return V.y7()},
zX:function(N){return V.zX(N)}};
this.V=new mKE(function(){return ACy(V)},function(){V.ZB()},this.api.jU(),this.api.G.bind(this.api));
this.T=new VZ(this.api);vo8(this.V)},ACy=function(p){return g.I(function(C){p.api.Jk("onOrchestrationBecameLeader");
return g.y(C,p.F1(),0)})},koY=function(p){var C,V;
return g.I(function(N){if(N.C==1)return g.y(N,B9(),2);if(N.C!=3){C=N.T;if(!C)return jx("PES is undefined"),N.return();p.C=new JCG(C,p.api,p.V,p.T);V=p.YR(C);return g.y(N,G2v(C,V,p.V,p.T,p.yn),3)}p.D=N.T;return g.y(N,oIP(p),0)})},oIP=function(p){var C;
return g.I(function(V){switch(V.C){case 1:if(!p.C)return jx("transferManager is undefined"),V.return();if(p.C.T){V.EY(2);break}return g.y(V,ex(p.C),2);case 2:if(!p.yn.G("woffle_enable_main_downloads_library")){V.EY(4);break}return g.y(V,p.dC(),4);case 4:if(!p.yn.G("html5_offline_playback_position_sync")){V.EY(6);break}return g.y(V,p.VY(),7);case 7:return g.y(V,p.zX(864E5),6);case 6:return g.y(V,p.refreshAllStaleEntities(43200,!0),9);case 9:return g.y(V,p.Ye(),10);case 10:if(!p.yn.G("html5_retry_downloads_for_expiration")){V.EY(11);
break}return g.y(V,p.y7(),11);case 11:return p.J=g.MU(function(){p.refreshAllStaleEntities(43200,!0);p.Ye()},9E5),g.Bw(g.p3(),function(){return p.aJ()}),g.y(V,B9(),13);
case 13:return C=V.T,g.y(V,Jxp(C),14);case 14:FGP(p.V),g.JQ(V)}})},xP2=function(){var p,C,V,N,H,X;
return g.I(function(d){switch(d.C){case 1:return g.y(d,B9(),2);case 2:p=d.T;if(!p)return d.return([]);C=Date.now()/1E3;return g.y(d,rp(p,"offlineVideoPolicy"),3);case 3:V=d.T,N=g.F(V),H=N.next();case 4:if(H.done){d.EY(6);break}X=H.value;if(!(X.expirationTimestamp&&Number(X.expirationTimestamp)<C)){d.EY(5);break}X.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";X.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.y(d,W9(p,X,"offlineVideoPolicy"),5);
case 5:H=N.next();d.EY(4);break;case 6:return d.return(V.map(function(a){return a.key}))}})},gQ=function(p,C,V,N,H){var X,d,a;
return g.I(function(E){if(E.C==1)return g.y(E,B9(),2);X=E.T;if(!X)return E.return([]);d=C.map(function(l){var t=g.d_(l,V);t={actionType:N,entityKey:t,actionMetadata:Object.assign({},qEP(),H)};N!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(t.actionMetadata.priority=0);l=new Mw(V,l,t);return vK(l)});
a=Ru0(X,d);vo8(p.V);return E.return(a)})},YMP=function(p,C,V,N){var H,X,d,a,E,l,t,c;
return g.I(function(T){switch(T.C){case 1:H=[],X=g.F(C),d=X.next();case 2:if(d.done){T.EY(4);break}a=d.value;if(a.upToDate||V&&!a.shouldAutoSyncMetadata||!a.playlistId){T.EY(3);break}E={};switch(N){case "mainPlaylistEntity":l={nextAutoRefreshIntervalSeconds:a.checkInSeconds,autoSync:V};E={mainPlaylistEntityActionMetadata:l};break;case "musicPlaylist":t={autoSync:V},E={musicPlaylistEntityActionMetadata:t}}return g.y(T,gQ(p,[a.playlistId],N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",E),6);case 6:(c=
T.T)&&H.push.apply(H,g.K(c));case 3:d=X.next();T.EY(2);break;case 4:return T.return(H)}})},zFf=function(p,C){var V;
return g.I(function(N){return C.length?(V=qEP(),g.RW(V,oz,{isEnqueuedForExpiredStreamUrlRefetch:!0}),p.api.k_("qrd",{v:C.length}),N.return(gQ(p,C,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",V))):N.return([])})},RFE=function(p,C,V){this.T=p;
this.yn=C;this.V=V},PuF=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f;
return g.I(function(q){switch(q.C){case 1:return V=il(C),N=g.Xq(C.entityKey),H=N.entityId,X=[],g.vv(q,2),g.y(q,nIy(p,H),4);case 4:X=q.T;if(!(p.yn.G("woffle_enable_main_downloads_library")&&((d=X)==null?0:d.length))){q.EY(5);break}return g.y(q,wf2(p.T,[C.entityKey]),5);case 5:g.Fe(q,3);break;case 2:return a=g.Sa(q),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",a instanceof g.T4&&a.type==="QUOTA_EXCEEDED"?(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):jx("Playlist add error"),q.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,E,l));case 3:t=[];if(!p.yn.G("html5_offline_prevent_redownload_downloaded_video")){q.EY(7);break}return g.y(q,O20(p.T,"mainVideoEntity",X),8);case 8:X=q.T;case 7:if((c=X)==null?0:c.length)for(T=g.F(X),M=T.next();!M.done;M=T.next())if(J=M.value,S=J.offlineVideoData,D=void 0,(D=S)==null?0:D.videoId)Z=void 0,f=Number(((Z=C.actionMetadata)==null?void 0:Z.priority)||
0)+1,t.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",S.videoId,"mainVideoEntity",f,WK,eFy(C,S,H)));return q.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,t))}})},$PY=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,Y,W,L,VL,au,Q,e,G,m,P,p0,Sy,V8,fY,jy,Tp,r1,u,U,O,b,x,pY,d1,Hv,k,ES,my,i9,ou,iP,RF,cy,$H,zt,El,zA,Rt,PG,Ke,$T,gW,wI,Th,ob,yO,T9,k7,x3,qj,ig,Dz,Hy,KX,R6;
return g.I(function(Tt){switch(Tt.C){case 1:return V=il(C),N=C.entityKey,H=g.Xq(N).entityId,X=[],d=!1,H==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.y(Tt,rp(p.T,"mainPlaylistEntity"),5)):g.y(Tt,Qa(p.T,N,"mainPlaylistEntity"),4);case 4:(a=Tt.T)&&X.push(a);Tt.EY(3);break;case 5:X=Tt.T;case 3:if((E=X)==null||!E.length)return Tt.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));l=g.n(C.actionMetadata,woY);c=(t=l)==null?void 0:t.nextAutoRefreshIntervalSeconds;M=(T=l)==null?void 0:T.autoSync;J=[];D=S=
!0;Z=!1;if(!d&&M===!1){Tt.EY(6);break}g.vv(Tt,7);return g.y(Tt,Hor(0,!!M,!0,X),9);case 9:J=Tt.T;g.Fe(Tt,8);break;case 7:f=g.Sa(Tt);if(!(f instanceof Error&&f.message==="No data")){f instanceof Error&&f.message==="Empty response body"&&jx(f.message);Tt.EY(8);break}return H==="!*$_ALL_ENTITIES_!*$"?g.y(Tt,YE8(p.T,C,p.V,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.y(Tt,kuP(H,p.T,C,p.V),8);case 8:if(!J.length||!d&&J[0].playlistId!==H)return Tt.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V));case 6:if(d){q=[];A=g.F(J);for(Y=A.next();!Y.done;Y=A.next())W=Y.value,W.upToDate||M&&!W.shouldAutoSyncMetadata||!W.playlistId||(L={nextAutoRefreshIntervalSeconds:W.checkInSeconds,autoSync:M},q.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",W.playlistId,"mainPlaylistEntity",0,WK,{mainPlaylistEntityActionMetadata:L})));return Tt.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,q))}J.length&&(VL=J[0],Z=!!VL.upToDate,M&&(S=(au=VL.shouldAutoSyncMetadata)!=null?au:!0,D=(Q=VL.shouldAutoSyncVideos)!=
null?Q:!0,VL.checkInSeconds&&(c=VL.checkInSeconds)));if(Z||!S)return Tt.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));e=[];G=X[0];if(!G.downloadState){m=void 0;Tt.EY(15);break}return g.y(Tt,Qa(p.T,G.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:m=Tt.T;case 15:return P=m,Sy=((p0=P)==null?0:p0.addedTimestampMillis)?String(P.addedTimestampMillis):void 0,g.vv(Tt,17),g.y(Tt,nIy(p,H,Sy,c),19);case 19:e=Tt.T;g.Fe(Tt,18);break;case 17:V8=g.Sa(Tt);if(!(V8 instanceof Error&&
V8.message==="No data for playlist")){if(V8 instanceof Error&&V8.message==="Empty response body for playlist")jx(V8.message);else return fY="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",jy="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",V8 instanceof g.T4&&V8.type==="QUOTA_EXCEEDED"&&(fY="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",jy="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Tt.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,fY,jy));Tt.EY(18);
break}return g.y(Tt,kuP(H,p.T,C,p.V),18);case 18:if(!D)return Tt.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));Tp=[];r1=new Map;if((u=e)==null?0:u.length)for(U=g.F(e),O=U.next();!O.done;O=U.next())b=O.value,x=b.offlineVideoData,pY=void 0,((pY=x)==null?0:pY.videoId)&&r1.set(x.videoId,x);d1=new Map;Hv=[];if((k=G)==null?0:(ES=k.videos)==null?0:ES.length)for(my=g.F(G.videos),i9=my.next();!i9.done;i9=my.next())if(ou=i9.value,iP=JSON.parse(g.Xq(ou).entityId),RF=iP.videoId)r1.has(RF)?(d1.set(RF,
r1.get(RF)),r1.delete(RF)):Hv.push(RF);$H=Number(((cy=C.actionMetadata)==null?void 0:cy.priority)||0)+1;zt=g.F(r1.entries());for(El=zt.next();!El.done;El=zt.next())zA=El.value,Rt=g.F(zA),PG=Rt.next().value,Ke=Rt.next().value,$T=PG,gW=Ke,Tp.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",$T,"mainVideoEntity",$H,WK,eFy(C,gW,H)));wI=g.F(d1.entries());for(Th=wI.next();!Th.done;Th=wI.next())ob=Th.value,yO=g.F(ob),T9=yO.next().value,k7=yO.next().value,x3=T9,qj=k7,Tp.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
x3,"mainVideoEntity",$H,WK,eFy(C,qj,H)));ig=g.F(Hv);for(Dz=ig.next();!Dz.done;Dz=ig.next())Hy=Dz.value,KX={playlistId:H},R6={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:KX},Tp.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Hy,"mainVideoEntity",0,WK,R6));return Tt.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,Tp))}})},LVG=function(p,C){var V,N,H,X;
return g.I(function(d){switch(d.C){case 1:return V=il(C),g.vv(d,2),N=g.Xq(C.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.y(d,YE8(p.T,C,p.V,(H=C.actionMetadata)==null?void 0:(X=H.offlineLoggingData)==null?void 0:X.offlineDeleteReason),5):g.y(d,kuP(N,p.T,C,p.V),6);case 6:if(!p.yn.G("woffle_enable_main_downloads_library")){d.EY(5);break}return g.y(d,$K2(p.T,C.entityKey),5);case 5:g.Fe(d,3);break;case 2:return g.Sa(d),d.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return d.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V))}})},nIy=function(p,C,V,N){var H,X,d,a,E,l,t;
return g.I(function(c){switch(c.C){case 1:return g.y(c,Vrr([C]),2);case 2:return H=c.T,g.y(c,gI2(p,H[0],V,N),3);case 3:return X=c.T,d=X.mainPlaylistEntity,a=X.nle,l=Axy(d,(E=a)==null?void 0:E.avatar),g.vv(c,4),g.y(c,Sx(l),6);case 6:g.Fe(c,5);break;case 4:t=g.Sa(c),t instanceof Error&&t.message==="Failed to fetch"&&jx(t.message);case 5:return c.return(H[0].videos)}})},gI2=function(p,C,V,N){var H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A;
return g.I(function(Y){switch(Y.C){case 1:H=Date.now().toString();V||(V=H);X=C.videos;d=C.playlistId;a=[];E=[];if(X)for(l=g.F(X),t=l.next();!t.done;t=l.next()){c=t.value;T=c.offlineVideoData;if(!T||!T.videoId)throw jx("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");M=T.videoId;J={videoId:M,playlistId:d};S={id:g.d_(JSON.stringify(J),"mainPlaylistVideoEntity"),video:g.d_(M,"mainVideoEntity")};a.push(S);E.push(S.id)}Z={key:g.d_(d,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:V,lastSyncedTimestampMillis:H};f={key:g.d_(d,"mainPlaylistEntity"),playlistId:d,videos:E,title:C.title,thumbnailStyleData:WVY(C),visibility:QqE(C),downloadState:Z.key};C.channel&&(q=C.channel.offlineChannelData,D=rCr(g.d_(d,"ytMainChannelEntity"),q),f.channelOwner=D.id);((A=f)==null?0:A.entityMetadata)?(f.entityMetadata.offlineLastModifiedTimestampSeconds=C.lastModifiedTimestamp,N&&(f.entityMetadata.nextAutoRefreshIntervalSeconds=String(N))):f&&(f.entityMetadata={nextAutoRefreshIntervalSeconds:N?
String(N):void 0,offlineLastModifiedTimestampSeconds:C.lastModifiedTimestamp});g.vv(Y,2);return g.y(Y,gp(p.T,{mode:"readwrite",L4:!0},function(W){var L=P9(W,f,"mainPlaylistEntity"),VL=P9(W,Z,"mainPlaylistDownloadStateEntity");L=[L,VL];VL=g.F(a);for(var au=VL.next();!au.done;au=VL.next())L.push(P9(W,au.value,"mainPlaylistVideoEntity"));D&&L.push(P9(W,D,"ytMainChannelEntity"));return g.K3.all(L)}),4);
case 4:g.Fe(Y,3);break;case 2:throw g.Sa(Y),jx("PES failure for playlist"),Error("PES failure for playlist");case 3:return Y.return({mainPlaylistEntity:f,nle:D,En_:a})}})},rCr=function(p,C){return{id:p,
channelId:C.channelId,title:C.title,avatar:C.thumbnail}},WVY=function(p){var C=[],V=p.videos;
V&&V.length>0&&C.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:V[0].offlineVideoData.thumbnail}}});if((p=p.additionalMetadadatas)&&p.length>0)for(p=g.F(p),V=p.next();!V.done;V=p.next()){var N=V.value.offlineBundleItemPlaylistData,H=void 0;V=(H=N)==null?void 0:H.style;H=void 0;N={collageThumbnail:{coverThumbnail:(H=N)==null?void 0:H.coverThumbnail}};switch(V){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":C.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:N});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":C.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:N});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":C.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:N});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":C.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:N})}}return C},QqE=function(p){switch(p.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},eFy=function(p,C,V){C={offlineVideoData:C,
playlistId:V};if(p=g.n(p.actionMetadata,woY))C.maximumDownloadQuality=p.maximumDownloadQuality;return{mainVideoEntityActionMetadata:C}},BEp=function(p,C,V){this.T=p;
this.yn=C;this.V=V},CI5=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J;
return g.I(function(S){switch(S.C){case 1:return V=il(C),N=g.Xq(C.entityKey),H=N.entityId,X=g.n(C.actionMetadata,QZ),a=!((d=X)==null?0:d.playlistId),g.vv(S,2),g.y(S,GoE(p,H,void 0,(E=X)==null?void 0:E.offlineVideoData,a),4);case 4:g.Fe(S,3);break;case 2:return l=g.Sa(S),t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.T4&&l.type==="QUOTA_EXCEEDED"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
S.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,t,c));case 3:T=1;T=Number(((M=C.actionMetadata)==null?void 0:M.priority)||0)+1;var D=(D=g.n(C.actionMetadata,QZ))?{playbackDataActionMetadata:{maximumDownloadQuality:D.maximumDownloadQuality}}:void 0;J=bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",H,"playbackData",T,pFf,D);return S.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,[J]))}})},jL8=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f;
return g.I(function(q){switch(q.C){case 1:return V=il(C),N=g.Xq(C.entityKey),H=N.entityId,g.y(q,Qa(p.T,C.entityKey,"mainVideoEntity"),2);case 2:X=q.T;if(!X){d=void 0;q.EY(3);break}return g.y(q,Qa(p.T,X.downloadState,"mainVideoDownloadStateEntity"),4);case 4:d=q.T;case 3:a=d;if(!X||!a)return q.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));g.vv(q,5);return g.y(q,GoE(p,H,a.addedTimestampMillis,(l=g.n(C.actionMetadata,QZ))==null?void 0:l.offlineVideoData),7);case 7:t=1;t=Number(((c=
C.actionMetadata)==null?void 0:c.priority)||0)+1;E=bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",H,"playbackData",t,pFf);g.Fe(q,6);break;case 5:T=g.Sa(q);if(!(T instanceof Error&&T.message==="No data")){if(T instanceof Error&&T.message==="Empty response body")jx(T.message);else return M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.T4&&T.type==="QUOTA_EXCEEDED"&&(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),q.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,M,J));q.EY(6);break}return g.y(q,ul(p.T,H),9);case 9:S=q.T;D=g.n(C.actionMetadata,QZ);if(f=(Z=D)==null?void 0:Z.playlistId)S.playlistId=f;S.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.y(q,K8(H,p.T,C,p.V,S),6);case 6:return q.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,E?[E]:void 0))}})},VJc=function(p,C){var V,N,H,X,d,a,E,l,t,c;
return g.I(function(T){switch(T.C){case 1:return V=il(C),g.vv(T,2),N=g.Xq(C.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.y(T,YE8(p.T,C,p.V,(t=C.actionMetadata)==null?void 0:(c=t.offlineLoggingData)==null?void 0:c.offlineDeleteReason),5):g.y(T,ul(p.T,N),6);case 6:H=T.T;X=g.n(C.actionMetadata,QZ);if(a=(d=X)==null?void 0:d.playlistId)H.playlistId=a;H.offlineDeleteReason=(E=C.actionMetadata)==null?void 0:(l=E.offlineLoggingData)==null?void 0:l.offlineDeleteReason;return g.y(T,K8(N,p.T,C,p.V,H),7);
case 7:if(!p.yn.G("woffle_enable_main_downloads_library")){T.EY(5);break}return g.y(T,$K2(p.T,C.entityKey),5);case 5:g.Fe(T,3);break;case 2:return g.Sa(T),T.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return T.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V))}})},GoE=function(p,C,V,N,H){var X,d,a,E,l,t;
return g.I(function(c){switch(c.C){case 1:if(X=N){c.EY(2);break}return g.y(c,j1f([C]),3);case 3:d=c.T,X=d[0];case 2:return g.y(c,N0r(p,X,V,H),4);case 4:a=c.T;E=a.mainVideoEntity;l=a.channelEntity;g.vv(c,5);var T=TY(E.thumbnail),M=TY(l.avatar);return g.y(c,Sx(T.concat(M)),7);case 7:g.Fe(c,0);break;case 5:t=g.Sa(c),t instanceof Error&&t.message==="Failed to fetch"&&jx(t.message),g.JQ(c)}})},N0r=function(p,C,V,N){var H,X,d,a,E,l,t,c,T,M,J,S,D;
return g.I(function(Z){switch(Z.C){case 1:V||(V=Date.now().toString());X=(H=C.channel)==null?void 0:H.offlineChannelData;d={id:g.d_(C.videoId,"ytMainChannelEntity"),channelId:X.channelId,title:X.title,avatar:X.thumbnail};a={key:g.d_(C.videoId,"mainVideoDownloadStateEntity"),playbackData:g.d_(C.videoId,"playbackData"),addedTimestampMillis:V,videoDownloadContextEntity:g.d_(C.videoId,"videoDownloadContextEntity")};E={key:g.d_(C.videoId,"videoPlaybackPositionEntity"),videoId:C.videoId,lastPlaybackPositionSeconds:"0"};
p.yn.G("html5_offline_playback_position_sync")&&(l={playbackPosition:E.key});t=g.d_(C.videoId,"mainVideoEntity");c={key:t,videoId:C.videoId,title:C.title,thumbnail:C.thumbnail,localizedStrings:{viewCount:C.shortViewCountText},userState:l,lengthSeconds:C.lengthSeconds?Number(C.lengthSeconds):void 0,publishedTimestampMillis:C.publishedTimestamp?(Number(C.publishedTimestamp)*1E3).toString():void 0,formattedDescription:C.description,owner:d.id,downloadState:a.key};if(!p.yn.G("woffle_enable_main_downloads_library")||
!N){Z.EY(2);break}return g.y(Z,P4E(p.T,[t]),3);case 3:if(J=Z.T)T=J.mainDownloadsLibraryEntity,M=J.mainDownloadsListEntity;case 2:return D=fof,S={key:g.d_(C.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.RW(a,D,S),g.y(Z,gp(p.T,{mode:"readwrite",L4:!0},function(f){var q=P9(f,d,"ytMainChannelEntity"),A=P9(f,a,"mainVideoDownloadStateEntity"),Y=P9(f,c,"mainVideoEntity");q=[q,A,Y];p.yn.G("html5_offline_playback_position_sync")&&(A=P9(f,E,"videoPlaybackPositionEntity"),
q.push(A));T&&(A=P9(f,T,"mainDownloadsLibraryEntity"),q.push(A));M&&(A=P9(f,M,"mainDownloadsListEntity"),q.push(A));S&&(f=P9(f,S,"downloadStatusEntity"),q.push(f));return g.K3.all(q)}),4);
case 4:return Z.return({mainVideoEntity:c,channelEntity:d})}})},Hg5=function(p,C,V){this.T=p;
this.yn=C;this.V=V},d8f=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,Y,W,L,VL,au,Q,e,G;
return g.I(function(m){switch(m.C){case 1:return V=il(C),N=[],g.y(m,x8.getInstance(),2);case 2:H=m.T;if(!H){m.EY(3);break}return g.y(m,H.get("sdois"),4);case 4:return X=m.T,g.y(m,(a=H)==null?void 0:a.get("lmqf"),5);case 5:d=m.T;case 3:g.vv(m,6);if(X===void 0)throw Error("prefStorage or opt-in state is undefined");E=[];if(X){m.EY(8);break}return g.y(m,eUy(p.T),9);case 9:E=m.T,E.reverse();case 8:if(!E.length){m.EY(10);break}l=g.F(E);t=l.next();case 11:if(t.done){m.EY(10);break}c=t.value;if(!c){m.EY(12);
break}T=g.Xq(c).entityId;return g.y(m,ul(p.T,T),14);case 14:return M=m.T,M.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.y(m,K8(T,p.T,{entityKey:c,actionType:C.actionType},p.V,M),12);case 12:t=l.next();m.EY(11);break;case 10:return g.y(m,dZv(X,(J=d)!=null?J:"SD"),16);case 16:return S=m.T,g.y(m,zUG(S),17);case 17:D=noY(S);if(!p.yn.G("woffle_enable_main_downloads_library")){m.EY(18);break}if(X){m.EY(19);break}return g.y(m,$K2(p.T,g.bS),19);case 19:return g.y(m,wf2(p.T,[g.bS]),18);
case 18:if((Z=D)==null?0:Z.length)for(f=g.F(D),q=f.next();!q.done;q=f.next())if(Y=A=q.value,W=Y.actionType,L=Y.entityKey,VL=Y.actionMetadata,W&&L&&VL&&!g.n(VL,XF0)){W==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(VL.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(au=g.n(A.actionMetadata,QZ))au.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",A.actionMetadata=Object.assign({},A.actionMetadata,{mainVideoEntityActionMetadata:au});N.push(A)}g.Fe(m,7);break;
case 6:return Q=g.Sa(m),e="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q instanceof g.T4&&Q.type==="QUOTA_EXCEEDED"&&(e="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),m.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,e,G));case 7:return m.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,N))}})},ig0=function(){L8.apply(this,arguments);
this.Z="mainVideoEntity"},hop=function(p,C,V){C=C===void 0?43200:C;
V=V===void 0?!0:V;var N=N===void 0?!1:N;var H,X,d;return g.I(function(a){switch(a.C){case 1:if(!p.Y.xq())return a.return([]);H=[];g.vv(a,2);return g.y(a,Hor(C,V,N),4);case 4:H=a.T;g.Fe(a,3);break;case 2:X=g.Sa(a),X instanceof Error&&X.message==="No data"||X instanceof Error&&X.message==="Empty response body"&&jx(X.message);case 3:return d=YMP(p,H,V,"mainPlaylistEntity"),a.return(d)}})},sLp=function(p,C,V,N){N=N===void 0?!1:N;
var H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f;return g.I(function(q){switch(q.C){case 1:return H=[],g.y(q,XpG(),2);case 2:return(X=q.T)||N?g.y(q,ioE(C,V),3):q.return([]);case 3:d=q.T;if((a=d)==null||!a.length)return q.return([]);E={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};l=g.F(d);t=l.next();case 4:if(t.done){q.EY(6);break}T=c=t.value;M=T.actionType;J=T.entityKey;S=T.actionMetadata;if(!(M&&J&&S)||g.n(S,XF0)){q.EY(5);break}M==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(S.offlineLoggingData=
E);D=g.Xq(J);Z=D.entityId;return g.y(q,gQ(p,[Z],"mainVideoEntity",M,S),8);case 8:f=q.T,H=H.concat(f);case 5:t=l.next();q.EY(4);break;case 6:return q.return(H)}})},aJ1=function(p,C){this.T=p;
this.V=C},lJ2=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z;
return g.I(function(f){switch(f.C){case 1:return V=il(C),N=g.Xq(C.entityKey),H=N.entityId,X=[],g.vv(f,2),g.y(f,EFp(p,H),4);case 4:X=f.T;if((d=X)==null||!d.length){f.EY(5);break}return g.y(f,rx2(p.T,C.entityKey),5);case 5:g.Fe(f,3);break;case 2:return a=g.Sa(f),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",a instanceof g.T4&&a.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
f.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,E,l));case 3:return t=[],g.y(f,O20(p.T,"musicTrack",X),7);case 7:X=f.T;if(X.length)for(c=g.F(X),T=c.next();!T.done;T=c.next())if(M=T.value,J=M.offlineVideoData,S=void 0,(S=J)==null?0:S.videoId)D=void 0,Z=Number(((D=C.actionMetadata)==null?void 0:D.priority)||0)+1,t.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J.videoId,"musicTrack",Z,rQ,Os(C,J,H)));return f.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,t))}})},
tJr=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,Y,W,L,VL,au,Q,e,G,m,P,p0,Sy,V8,fY,jy,Tp,r1,u,U,O,b,x,pY,d1,Hv,k,ES,my,i9,ou,iP,RF,cy,$H,zt,El,zA,Rt,PG,Ke;
return g.I(function($T){switch($T.C){case 1:return V=il(C),N=C.entityKey,H=g.Xq(N).entityId,X=[],d=!1,H==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.y($T,rp(p.T,"musicAlbumRelease"),5)):g.y($T,Qa(p.T,N,"musicAlbumRelease"),4);case 4:(a=$T.T)&&X.push(a);$T.EY(3);break;case 5:X=$T.T;case 3:if((E=X)==null||!E.length)return $T.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));if(d){l=[];t=g.F(X);for(c=t.next();!c.done;c=t.next())T=c.value,M=g.Xq(T.id).entityId,l.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
M,"musicAlbumRelease",0,rQ));return $T.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,l))}J=[];S=X[0];D=void 0;if(!S.downloadMetadata){$T.EY(6);break}return g.y($T,Qa(p.T,S.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:Z=$T.T,D=Number((q=(f=Z)==null?void 0:f.addedTimestampMillis)!=null?q:"0")/1E3;case 6:return g.vv($T,8),g.y($T,EFp(p,H,(A=D)==null?void 0:A.toString()),10);case 10:J=$T.T;g.Fe($T,9);break;case 8:Y=g.Sa($T);if(!(Y instanceof Error&&Y.message===
"No data")){if(Y instanceof Error&&Y.message==="Empty response body")jx(Y.message);else return W="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Y instanceof g.T4&&Y.type==="QUOTA_EXCEEDED"&&(W="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),$T.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,W,L));$T.EY(9);break}return g.y($T,Us(H,"musicAlbumRelease",p.T,
C,p.V),9);case 9:VL=[];au=new Map;if((Q=J)==null?0:Q.length)for(e=g.F(J),G=e.next();!G.done;G=e.next())m=G.value,P=m.offlineVideoData,p0=void 0,((p0=P)==null?0:p0.videoId)&&au.set(P.videoId,P);Sy=new Map;V8=[];if((fY=S)==null?0:(jy=fY.tracks)==null?0:jy.length)for(Tp=g.F(S.tracks),r1=Tp.next();!r1.done;r1=Tp.next())if(u=r1.value,U=g.Xq(u).entityId)au.has(U)?(Sy.set(U,au.get(U)),au.delete(U)):V8.push(U);b=Number(((O=C.actionMetadata)==null?void 0:O.priority)||0)+1;x=g.F(au.entries());for(pY=x.next();!pY.done;pY=
x.next())d1=pY.value,Hv=g.F(d1),k=Hv.next().value,ES=Hv.next().value,my=k,i9=ES,VL.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",my,"musicTrack",b,rQ,Os(C,i9)));ou=g.F(Sy.entries());for(iP=ou.next();!iP.done;iP=ou.next())RF=iP.value,cy=g.F(RF),$H=cy.next().value,zt=cy.next().value,El=$H,zA=zt,VL.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",El,"musicTrack",b,rQ,Os(C,zA)));Rt=g.F(V8);for(PG=Rt.next();!PG.done;PG=Rt.next())Ke=PG.value,VL.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Ke,
"musicTrack",0,rQ));return $T.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,VL))}})},ck8=function(p,C){var V,N;
return g.I(function(H){switch(H.C){case 1:return V=il(C),g.vv(H,2),N=g.Xq(C.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.y(H,f8(p.T,C,p.V),5):g.y(H,Us(N,"musicAlbumRelease",p.T,C,p.V),6);case 6:return g.y(H,B9p(p.T,C.entityKey),5);case 5:g.Fe(H,3);break;case 2:return g.Sa(H),H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},EFp=function(p,C,V){var N,H,X;
return g.I(function(d){switch(d.C){case 1:return g.y(d,Vrr([C]),2);case 2:return N=d.T,g.y(d,T0y(p,N[0],V),3);case 3:return H=d.T,X=TY(H.thumbnailDetails),g.y(d,Sx(X),4);case 4:return d.return(N[0].videos)}})},T0y=function(p,C,V){var N,H,X,d,a,E,l,t,c,T,M,J,S,D;
return g.I(function(Z){if(Z.C==1){N=C.additionalMetadadatas;H=void 0;if(N&&N.length>0)for(X=g.F(N),d=X.next();!d.done;d=X.next())if(a=d.value,a.offlineMusicPlaylistData){H=a.offlineMusicPlaylistData;break}E=C.playlistId;l=Gu5(C);t=l.UN;c=l.tO;T=V?(Number(V)*1E3).toString():Date.now().toString();M=C.lastModifiedTimestamp?(Number(C.lastModifiedTimestamp)*1E3).toString():"0";J={id:g.d_(E,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:c,lastModifiedTimestampMillis:M,addedTimestampMillis:T,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};S={id:g.d_(E,"musicAlbumRelease"),title:C.title,audioPlaylistId:E,trackCount:C.totalVideoCount,tracks:t,downloadMetadata:J.id};H&&(S.thumbnailDetails=(D=H.albumHqThumbnail)!=null?D:H.albumArtistThumbnail,S.artistDisplayName=H.albumArtistDisplayName,S.releaseDate=H.albumReleaseDate,S.contentRating={explicitType:H.albumReleaseExplicitType},S.releaseType=H.albumReleaseType);return g.y(Z,gp(p.T,{mode:"readwrite",L4:!0},function(f){var q=P9(f,S,"musicAlbumRelease");
f=P9(f,J,"musicAlbumReleaseDownloadMetadataEntity");return g.K3.all([q,f])}),2)}return Z.return(S)})},MJc=function(p,C){this.T=p;
this.V=C},m80=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z;
return g.I(function(f){switch(f.C){case 1:return V=il(C),N=g.Xq(C.entityKey),H=N.entityId,X=[],g.vv(f,2),g.y(f,JkF(p,H),4);case 4:X=f.T;if((d=X)==null||!d.length){f.EY(5);break}return g.y(f,rx2(p.T,C.entityKey),5);case 5:g.Fe(f,3);break;case 2:return a=g.Sa(f),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",a instanceof g.T4&&a.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
f.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,E,l));case 3:return t=[],g.y(f,O20(p.T,"musicTrack",X),7);case 7:X=f.T;if(X.length)for(c=g.F(X),T=c.next();!T.done;T=c.next())if(M=T.value,J=M.offlineVideoData,S=void 0,(S=J)==null?0:S.videoId)D=void 0,Z=Number(((D=C.actionMetadata)==null?void 0:D.priority)||0)+1,t.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J.videoId,"musicTrack",Z,BK,Os(C,J,H)));return f.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,t))}})},
vFE=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,Y,W,L,VL,au,Q,e,G,m,P,p0,Sy,V8,fY,jy,Tp,r1,u,U,O,b,x,pY,d1,Hv,k,ES,my,i9,ou,iP,RF,cy,$H,zt,El,zA,Rt,PG,Ke,$T,gW,wI,Th,ob,yO,T9,k7,x3,qj,ig,Dz;
return g.I(function(Hy){switch(Hy.C){case 1:return V=il(C),N=C.entityKey,H=g.Xq(N).entityId,X=[],d=!1,H==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.y(Hy,rp(p.T,"musicPlaylist"),5)):g.y(Hy,Qa(p.T,N,"musicPlaylist"),4);case 4:(a=Hy.T)&&X.push(a);Hy.EY(3);break;case 5:X=Hy.T;case 3:if((E=X)==null||!E.length)return Hy.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));l=g.n(C.actionMetadata,ppr);c=(t=l)==null?void 0:t.autoSync;T=[];J=M=!0;S=!1;D=void 0;if(!d&&c===!1){Hy.EY(6);break}g.vv(Hy,7);return g.y(Hy,
hz8(0,!!c,!0,X),9);case 9:T=Hy.T;g.Fe(Hy,8);break;case 7:Z=g.Sa(Hy);if(!(Z instanceof Error&&Z.message==="No data")){Z instanceof Error&&Z.message==="Empty response body"&&jx(Z.message);Hy.EY(8);break}return H==="!*$_ALL_ENTITIES_!*$"?g.y(Hy,f8(p.T,C,p.V),8):g.y(Hy,Us(H,"musicPlaylist",p.T,C,p.V),8);case 8:if(!T.length||!d&&T[0].playlistId!==H)return Hy.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));case 6:if(d){f=[];q=g.F(T);for(A=q.next();!A.done;A=q.next())Y=A.value,Y.upToDate||
c&&!Y.shouldAutoSyncMetadata||!Y.playlistId||(W={autoSync:c},f.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Y.playlistId,"musicPlaylist",0,BK,{musicPlaylistEntityActionMetadata:W})));return Hy.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,f))}T.length&&(L=T[0],S=!!L.upToDate,c&&(M=(VL=L.shouldAutoSyncMetadata)!=null?VL:!0,J=(au=L.shouldAutoSyncVideos)!=null?au:!0,L.checkInSeconds&&(D=L.checkInSeconds)));if(S||!M)return Hy.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V));Q=[];e=X[0];G=void 0;if(!e.downloadMetadata){Hy.EY(15);break}return g.y(Hy,Qa(p.T,e.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:m=Hy.T,G=Number((p0=(P=m)==null?void 0:P.addedTimestampMillis)!=null?p0:"0")/1E3;case 15:return g.vv(Hy,17),g.y(Hy,JkF(p,H,(Sy=G)==null?void 0:Sy.toString(),D),19);case 19:Q=Hy.T;g.Fe(Hy,18);break;case 17:V8=g.Sa(Hy);if(!(V8 instanceof Error&&V8.message==="No data")){if(V8 instanceof Error&&V8.message==="Empty response body")jx(V8.message);else return fY=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",jy="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",V8 instanceof g.T4&&V8.type==="QUOTA_EXCEEDED"&&(fY="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",jy="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Hy.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,fY,jy));Hy.EY(18);break}return g.y(Hy,Us(H,"musicPlaylist",p.T,C,p.V),18);case 18:if(!J)return Hy.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V));Tp=[];r1=new Map;if((u=Q)==null?0:u.length)for(U=g.F(Q),O=U.next();!O.done;O=U.next())b=O.value,x=b.offlineVideoData,pY=void 0,((pY=x)==null?0:pY.videoId)&&r1.set(x.videoId,x);d1=new Map;Hv=[];if((k=e)==null?0:(ES=k.tracks)==null?0:ES.length)for(my=g.F(e.tracks),i9=my.next();!i9.done;i9=my.next())if(ou=i9.value,iP=g.Xq(ou).entityId)r1.has(iP)?(d1.set(iP,r1.get(iP)),r1.delete(iP)):Hv.push(iP);cy=Number(((RF=C.actionMetadata)==null?void 0:RF.priority)||0)+1;$H=g.F(r1.entries());for(zt=$H.next();!zt.done;zt=
$H.next())El=zt.value,zA=g.F(El),Rt=zA.next().value,PG=zA.next().value,Ke=Rt,$T=PG,Tp.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Ke,"musicTrack",cy,BK,Os(C,$T)));gW=g.F(d1.entries());for(wI=gW.next();!wI.done;wI=gW.next())Th=wI.value,ob=g.F(Th),yO=ob.next().value,T9=ob.next().value,k7=yO,x3=T9,Tp.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",k7,"musicTrack",cy,BK,Os(C,x3)));qj=g.F(Hv);for(ig=qj.next();!ig.done;ig=qj.next())Dz=ig.value,Tp.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Dz,"musicTrack",0,BK));return Hy.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,Tp))}})},FlP=function(p,C){var V,N;
return g.I(function(H){switch(H.C){case 1:return V=il(C),g.vv(H,2),N=g.Xq(C.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.y(H,f8(p.T,C,p.V),5):g.y(H,Us(N,"musicPlaylist",p.T,C,p.V),6);case 6:return g.y(H,B9p(p.T,C.entityKey),5);case 5:g.Fe(H,3);break;case 2:return g.Sa(H),H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},JkF=function(p,C,V,N){var H,X,d;
return g.I(function(a){switch(a.C){case 1:return g.y(a,Vrr([C]),2);case 2:return H=a.T,g.y(a,SdY(p,H[0],V,N),3);case 3:return X=a.T,d=TY(X.thumbnailDetails),g.y(a,Sx(d),4);case 4:return a.return(H[0].videos)}})},SdY=function(p,C,V,N){var H,X,d,a,E,l,t,c,T;
return g.I(function(M){return M.C==1?(H=C.playlistId,X=Gu5(C),d=X.UN,a=X.tO,E=V?(Number(V)*1E3).toString():Date.now().toString(),l=C.lastModifiedTimestamp?(Number(C.lastModifiedTimestamp)*1E3).toString():"0",t={id:g.d_(H,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:a,lastModifiedTimestampMillis:l,addedTimestampMillis:E,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},c={id:g.d_(H,"musicPlaylist"),title:C.title,playlistId:H,thumbnailDetails:C.thumbnail,visibility:Klf(C),trackCount:C.totalVideoCount,
tracks:d,downloadMetadata:t.id},N&&(((T=c)==null?0:T.entityMetadata)?c.entityMetadata.nextAutoRefreshIntervalSeconds=String(N):c&&(c.entityMetadata={nextAutoRefreshIntervalSeconds:String(N)})),g.y(M,gp(p.T,{mode:"readwrite",L4:!0},function(J){var S=P9(J,c,"musicPlaylist");J=P9(J,t,"musicPlaylistDownloadMetadataEntity");return g.K3.all([S,J])}),2)):M.return(c)})},Klf=function(p){switch(p.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},D82=function(p,C){this.T=p;
this.V=C},fJy=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J;
return g.I(function(S){switch(S.C){case 1:return V=il(C),N=g.Xq(C.entityKey),H=N.entityId,X=g.n(C.actionMetadata,uVY),g.vv(S,2),g.y(S,ZgE(p,H,void 0,(d=X)==null?void 0:d.track,(a=X)==null?void 0:a.albumRelease),4);case 4:if((E=X)==null?0:E.playlistId){S.EY(5);break}return g.y(S,rx2(p.T,C.entityKey),5);case 5:g.Fe(S,3);break;case 2:return l=g.Sa(S),t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.T4&&l.type==="QUOTA_EXCEEDED"&&
(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),S.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,t,c));case 3:M=Number(((T=C.actionMetadata)==null?void 0:T.priority)||0)+1;var D=(D=g.n(C.actionMetadata,uVY))?{playbackDataActionMetadata:{maximumDownloadQuality:D.maximumDownloadQuality}}:void 0;J=bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",H,"playbackData",M,U85,D);return S.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V,[J]))}})},Og2=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D;
return g.I(function(Z){switch(Z.C){case 1:return V=il(C),N=g.Xq(C.entityKey),H=N.entityId,g.y(Z,Qa(p.T,C.entityKey,"musicTrack"),2);case 2:X=Z.T;if(!X){d=void 0;Z.EY(3);break}return g.y(Z,Qa(p.T,X.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:d=Z.T;case 3:a=d;if(!X||!a)return Z.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));l=g.n(C.actionMetadata,uVY);g.vv(Z,5);return g.y(Z,ZgE(p,H,a.addedTimestampMillis,(t=l)==null?void 0:t.track,(c=l)==null?void 0:c.albumRelease),
7);case 7:M=Number(((T=C.actionMetadata)==null?void 0:T.priority)||0)+1;E=bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",H,"playbackData",M,U85);g.Fe(Z,6);break;case 5:J=g.Sa(Z);if(!(J instanceof Error&&J.message==="No data")){if(J instanceof Error&&J.message==="Empty response body")jx(J.message);else return S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",J instanceof g.T4&&J.type==="QUOTA_EXCEEDED"&&(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Z.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,S,D));Z.EY(6);break}return g.y(Z,Z2(H,p.T,C,p.V),6);case 6:return Z.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,E?[E]:void 0))}})},ykY=function(p,C){var V,N;
return g.I(function(H){switch(H.C){case 1:return V=il(C),g.vv(H,2),N=g.Xq(C.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.y(H,f8(p.T,C,p.V),5):g.y(H,Z2(N,p.T,C,p.V),6);case 6:return g.y(H,B9p(p.T,C.entityKey),5);case 5:g.Fe(H,3);break;case 2:return g.Sa(H),H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},ZgE=function(p,C,V,N,H){var X,d,a,E,l,t;
return g.I(function(c){switch(c.C){case 1:if(X=N){c.EY(2);break}return g.y(c,j1f([C]),3);case 3:d=c.T,a=d[0],X=Q9p(a);case 2:return g.y(c,qdF(p,X,C,H,V),4);case 4:E=c.T;l=E.musicTrackEntity;t=E.Fw;var T=TY(l.thumbnailDetails),M=[];t&&(M=TY(t.thumbnailDetails));return g.y(c,Sx(T.concat(M)),0)}})},qdF=function(p,C,V,N,H){var X;
return g.I(function(d){return d.C==1?(H||(H=Date.now().toString()),X={id:g.d_(V,"musicTrackDownloadMetadataEntity"),playbackData:g.d_(V,"playbackData"),addedTimestampMillis:H,videoDownloadContextEntity:g.d_(V,"videoDownloadContextEntity")},N&&(C.albumRelease=N.id),g.y(d,gp(p.T,{mode:"readwrite",L4:!0},function(a){var E=[],l=P9(a,X,"musicTrackDownloadMetadataEntity");E.push(l);l=P9(a,C,"musicTrack");E.push(l);N&&(a=P9(a,N,"musicAlbumRelease"),E.push(a));return g.K3.all(E)}),2)):d.C!=3?g.y(d,ll(V,"musicTrackDownloadMetadataEntity",
p.T,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):d.return({musicTrackEntity:C,
Fw:N})})},GY=function(){L8.apply(this,arguments);
this.Z="musicTrack"},IJy=function(p,C,V){C=C===void 0?43200:C;
V=V===void 0?!0:V;var N=N===void 0?!1:N;var H,X;return g.I(function(d){switch(d.C){case 1:if(!p.Y.xq())return d.return([]);H=[];g.vv(d,2);return g.y(d,hz8(C,V,N),4);case 4:H=d.T;g.Fe(d,3);break;case 2:g.Sa(d);case 3:return X=YMP(p,H,V,"musicPlaylist"),d.return(X)}})},bgc=function(){g.IT.apply(this,arguments);
var p=this;this.events=new g.Ir(this);this.yn=this.player.K();this.VZ={nEY:function(){return p.T},
SM:function(){return p.SM()},
Dz:function(C){return p.Dz(C)}}},AkE=function(p){var C;
p=g.n((C=p.getWatchNextResponse())==null?void 0:C.currentVideoEndpoint,g.rP);if(p==null?0:p.playlistId)var V=p.playlistId;return V},oF5=function(p,C){var V,N,H,X;
return g.I(function(d){if(d.C==1){V=C.clientPlaybackNonce;N={cpn:V,offlineSourceVisualElement:g.Km(C.Sa||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};C.C&&(N.videoFmt=Number(C.C.itag));C.S&&(N.audioFmt=Number(C.S.itag));if((H=AkE(C))&&C.videoId){var a=C.videoId;a=H!=="PPSV"?Promise.resolve(!1):p.T.Z2(a);d=g.y(d,a,3)}else d=d.EY(2);return d}d.C!=2&&(X=d.T)&&(N.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");p.C=V;g.h1("offlinePlaybackStarted",N);g.JQ(d)})};
g.v(oU,Ai);g.Xe.Object.defineProperties(oU.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.T.entityMetadata},
set:function(p){this.T.entityMetadata=p}}});
g.v(A$c,oU);A$c.prototype.C=function(){return[]};
g.v(oNc,oU);oNc.prototype.C=function(){return[]};
g.v(kqE,oU);kqE.prototype.C=function(){return[]};
g.v(xj8,oU);xj8.prototype.C=function(){var p=[];this.T.alternateChannel&&p.push(this.T.alternateChannel);this.T.alternateChannelList&&p.push.apply(p,g.K(this.T.alternateChannelList));this.T.oneofChannelEntity&&p.push(this.T.oneofChannelEntity);return[].concat(g.K(new Set(p)))};
g.v(Y$F,oU);Y$F.prototype.C=function(){var p=[];this.T.entryCollection&&p.push(this.T.entryCollection);return[].concat(g.K(new Set(p)))};
g.v(zZ8,Ai);zZ8.prototype.C=function(){var p=[];this.T.video&&p.push(this.T.video);return[].concat(g.K(new Set(p)))};
g.v(RZG,oU);RZG.prototype.C=function(){var p=[];this.T.parentPlaylist&&p.push(this.T.parentPlaylist);if(this.T.entries)for(var C=g.F(this.T.entries),V=C.next();!V.done;V=C.next())p.push.apply(p,g.K((new zZ8(V.value)).C()));return[].concat(g.K(new Set(p)))};
g.v(nN2,oU);nN2.prototype.C=function(){var p=[];this.T.descriptionEntity&&p.push(this.T.descriptionEntity);this.T.creators&&p.push.apply(p,g.K(this.T.creators));this.T.theBiggestFan&&p.push(this.T.theBiggestFan);return[].concat(g.K(new Set(p)))};
g.v(eZ0,oU);eZ0.prototype.C=function(){return[]};
g.v(P3v,oU);P3v.prototype.C=function(){return[]};
g.v(wi2,oU);wi2.prototype.C=function(){return[]};
g.v($j5,oU);$j5.prototype.C=function(){return[]};
g.v(L0f,oU);L0f.prototype.C=function(){return[]};
g.v(gNY,oU);gNY.prototype.C=function(){return[]};
g.v(W0v,oU);W0v.prototype.C=function(){return[]};
g.v(QXr,oU);QXr.prototype.C=function(){return[]};
g.v(r$P,oU);r$P.prototype.C=function(){return[]};
g.v(BUY,oU);BUY.prototype.C=function(){var p=[];this.T.downloadsList&&p.push(this.T.downloadsList);this.T.smartDownloadsList&&p.push(this.T.smartDownloadsList);this.T.recommendedDownloadsList&&p.push(this.T.recommendedDownloadsList);this.T.refresh&&p.push(this.T.refresh);return[].concat(g.K(new Set(p)))};
g.v(GqE,Ai);GqE.prototype.C=function(){var p=[];this.T.video&&p.push(this.T.video);this.T.playlist&&p.push(this.T.playlist);this.T.videoItem&&p.push(this.T.videoItem);this.T.playlistItem&&p.push(this.T.playlistItem);return[].concat(g.K(new Set(p)))};
g.v(p28,oU);p28.prototype.C=function(){var p=[];this.T.refresh&&p.push(this.T.refresh);if(this.T.downloads)for(var C=g.F(this.T.downloads),V=C.next();!V.done;V=C.next())p.push.apply(p,g.K((new GqE(V.value)).C()));return[].concat(g.K(new Set(p)))};
g.v(CpE,oU);CpE.prototype.C=function(){var p=[];this.T.localImageEntities&&p.push.apply(p,g.K(this.T.localImageEntities));return[].concat(g.K(new Set(p)))};
g.v(js5,oU);js5.prototype.C=function(){var p=[];this.T.playbackData&&p.push(this.T.playbackData);this.T.localImageEntities&&p.push.apply(p,g.K(this.T.localImageEntities));this.T.videoDownloadContextEntity&&p.push(this.T.videoDownloadContextEntity);return[].concat(g.K(new Set(p)))};
g.v(VZf,oU);VZf.prototype.C=function(){return[]};
g.v(Nhv,oU);Nhv.prototype.C=function(){var p=[];this.T.fakeChildren&&p.push.apply(p,g.K(this.T.fakeChildren));return[].concat(g.K(new Set(p)))};
g.v(HE8,oU);HE8.prototype.C=function(){var p=[];this.T.video&&p.push(this.T.video);this.T.playbackData&&p.push(this.T.playbackData);this.T.offlineVideoPolicy&&p.push(this.T.offlineVideoPolicy);return[].concat(g.K(new Set(p)))};
g.v(X2Y,oU);X2Y.prototype.C=function(){return[]};
g.v(d_E,oU);d_E.prototype.C=function(){var p=[];this.T.channelOwner&&p.push(this.T.channelOwner);this.T.videos&&p.push.apply(p,g.K(this.T.videos));this.T.collaboratorChannels&&p.push.apply(p,g.K(this.T.collaboratorChannels));this.T.downloadState&&p.push(this.T.downloadState);this.T.refresh&&p.push(this.T.refresh);return[].concat(g.K(new Set(p)))};
g.v(iEF,oU);iEF.prototype.C=function(){var p=[];this.T.video&&p.push(this.T.video);this.T.channelContributor&&p.push(this.T.channelContributor);return[].concat(g.K(new Set(p)))};
g.v(hpr,Ai);hpr.prototype.C=function(){var p=[];this.T.localImageEntities&&p.push.apply(p,g.K(this.T.localImageEntities));this.T.videoDownloadContextEntity&&p.push(this.T.videoDownloadContextEntity);return[].concat(g.K(new Set(p)))};
g.v(ssF,Ai);ssF.prototype.C=function(){var p=[];this.T.recommendedVideoMetadata&&p.push.apply(p,g.K((new hpr(this.T.recommendedVideoMetadata)).C()));return[].concat(g.K(new Set(p)))};
g.v(aq2,Ai);aq2.prototype.C=function(){var p=[];this.T.playbackPosition&&p.push(this.T.playbackPosition);return[].concat(g.K(new Set(p)))};
g.v(E30,oU);E30.prototype.C=function(){var p=[];this.T.owner&&p.push(this.T.owner);this.T.downloadState&&p.push(this.T.downloadState);this.T.userState&&p.push.apply(p,g.K((new aq2(this.T.userState)).C()));this.T.additionalMetadata&&p.push.apply(p,g.K((new ssF(this.T.additionalMetadata)).C()));return[].concat(g.K(new Set(p)))};
g.v(lq0,oU);lq0.prototype.C=function(){var p=[];this.T.userChannelDetails&&p.push(this.T.userChannelDetails);return[].concat(g.K(new Set(p)))};
g.v(tZE,oU);tZE.prototype.C=function(){var p=[];this.T.channelOwner&&p.push(this.T.channelOwner);this.T.playbackPosition&&p.push(this.T.playbackPosition);this.T.localImageEntities&&p.push.apply(p,g.K(this.T.localImageEntities));this.T.downloadStatus&&p.push(this.T.downloadStatus);return[].concat(g.K(new Set(p)))};
g.v(cEY,oU);cEY.prototype.C=function(){return[]};
g.v(Thf,oU);Thf.prototype.C=function(){return[]};
g.v(MZv,oU);MZv.prototype.C=function(){return[]};
g.v(JEp,oU);JEp.prototype.C=function(){return[]};
g.v(m_f,oU);m_f.prototype.C=function(){return[]};
g.v(v3f,oU);v3f.prototype.C=function(){return[]};
g.v(Fn5,oU);Fn5.prototype.C=function(){return[]};
g.v(SVv,oU);SVv.prototype.C=function(){return[]};
g.v(Kn0,oU);Kn0.prototype.C=function(){return[]};
g.v(D_1,oU);D_1.prototype.C=function(){return[]};
g.v(ufE,oU);ufE.prototype.C=function(){var p=[];this.T.trackDownloadMetadatas&&p.push.apply(p,g.K(this.T.trackDownloadMetadatas));return[].concat(g.K(new Set(p)))};
g.v(ZEv,oU);
ZEv.prototype.C=function(){var p=[];this.T.downloadedTracks&&p.push.apply(p,g.K(this.T.downloadedTracks));this.T.smartDownloadedTracks&&p.push.apply(p,g.K(this.T.smartDownloadedTracks));this.T.downloadedEpisodes&&p.push.apply(p,g.K(this.T.downloadedEpisodes));this.T.downloadedAlbumReleases&&p.push.apply(p,g.K(this.T.downloadedAlbumReleases));this.T.smartDownloadedAlbumReleases&&p.push.apply(p,g.K(this.T.smartDownloadedAlbumReleases));this.T.downloadedPlaylists&&p.push.apply(p,g.K(this.T.downloadedPlaylists));this.T.smartDownloadedPlaylists&&
p.push.apply(p,g.K(this.T.smartDownloadedPlaylists));this.T.metadataOnlyTracks&&p.push.apply(p,g.K(this.T.metadataOnlyTracks));return[].concat(g.K(new Set(p)))};
g.v(U_P,oU);U_P.prototype.C=function(){var p=[];this.T.trackDownloadMetadatas&&p.push.apply(p,g.K(this.T.trackDownloadMetadatas));return[].concat(g.K(new Set(p)))};
g.v(fq1,oU);fq1.prototype.C=function(){var p=[];this.T.playbackData&&p.push(this.T.playbackData);this.T.localImageEntities&&p.push.apply(p,g.K(this.T.localImageEntities));this.T.videoDownloadContextEntity&&p.push(this.T.videoDownloadContextEntity);return[].concat(g.K(new Set(p)))};
g.v(OEY,oU);OEY.prototype.C=function(){var p=[];this.T.musicLibraryStatusEntity&&p.push(this.T.musicLibraryStatusEntity);this.T.primaryArtists&&p.push.apply(p,g.K(this.T.primaryArtists));this.T.details&&p.push(this.T.details);this.T.userDetails&&p.push(this.T.userDetails);this.T.tracks&&p.push.apply(p,g.K(this.T.tracks));this.T.share&&p.push(this.T.share);this.T.downloadMetadata&&p.push(this.T.downloadMetadata);this.T.refresh&&p.push(this.T.refresh);return[].concat(g.K(new Set(p)))};
g.v(yE2,oU);yE2.prototype.C=function(){var p=[];this.T.albumRelease&&p.push(this.T.albumRelease);this.T.tracks&&p.push.apply(p,g.K(this.T.tracks));return[].concat(g.K(new Set(p)))};
g.v(qV5,oU);qV5.prototype.C=function(){var p=[];this.T.albumRelease&&p.push(this.T.albumRelease);return[].concat(g.K(new Set(p)))};
g.v(Iq8,oU);Iq8.prototype.C=function(){var p=[];this.T.details&&p.push(this.T.details);this.T.userDetails&&p.push(this.T.userDetails);return[].concat(g.K(new Set(p)))};
g.v(bEv,oU);bEv.prototype.C=function(){var p=[];this.T.parentArtist&&p.push(this.T.parentArtist);return[].concat(g.K(new Set(p)))};
g.v(AEc,oU);AEc.prototype.C=function(){var p=[];this.T.parentArtist&&p.push(this.T.parentArtist);return[].concat(g.K(new Set(p)))};
g.v(o3p,oU);o3p.prototype.C=function(){return[]};
g.v(ki1,oU);ki1.prototype.C=function(){return[]};
g.v(x_F,Ai);x_F.prototype.C=function(){var p=[];this.T.creatorEntity&&p.push(this.T.creatorEntity);return[].concat(g.K(new Set(p)))};
g.v(YVr,oU);
YVr.prototype.C=function(){var p=[];this.T.tracks&&p.push.apply(p,g.K(this.T.tracks));this.T.refresh&&p.push(this.T.refresh);this.T.musicLibraryStatusEntity&&p.push(this.T.musicLibraryStatusEntity);this.T.details&&p.push(this.T.details);this.T.downloadMetadata&&p.push(this.T.downloadMetadata);this.T.sideloadMetadata&&p.push(this.T.sideloadMetadata);this.T.userDetails&&p.push(this.T.userDetails);this.T.entryCollection&&p.push(this.T.entryCollection);this.T.share&&p.push(this.T.share);this.T.podcastShowAdditionalMetadata&&p.push.apply(p,
g.K((new x_F(this.T.podcastShowAdditionalMetadata)).C()));return[].concat(g.K(new Set(p)))};
g.v(zpf,oU);zpf.prototype.C=function(){return[]};
g.v(Rpy,oU);
Rpy.prototype.C=function(){var p=[];this.T.musicLibraryStatusEntity&&p.push(this.T.musicLibraryStatusEntity);this.T.artists&&p.push.apply(p,g.K(this.T.artists));this.T.audioModeVersion&&p.push(this.T.audioModeVersion);this.T.videoModeVersion&&p.push(this.T.videoModeVersion);this.T.userDetails&&p.push(this.T.userDetails);this.T.details&&p.push(this.T.details);this.T.albumRelease&&p.push(this.T.albumRelease);this.T.share&&p.push(this.T.share);this.T.libraryEdit&&p.push(this.T.libraryEdit);this.T.downloadMetadata&&
p.push(this.T.downloadMetadata);this.T.playbackPosition&&p.push(this.T.playbackPosition);this.T.lyrics&&p.push(this.T.lyrics);return[].concat(g.K(new Set(p)))};
g.v(n32,oU);n32.prototype.C=function(){var p=[];this.T.parentTrack&&p.push(this.T.parentTrack);return[].concat(g.K(new Set(p)))};
g.v(ep5,oU);ep5.prototype.C=function(){var p=[];this.T.parentTrack&&p.push(this.T.parentTrack);return[].concat(g.K(new Set(p)))};
g.v(Ppv,oU);Ppv.prototype.C=function(){return[]};
g.v(w22,oU);w22.prototype.C=function(){return[]};
g.v($_E,oU);$_E.prototype.C=function(){return[]};
g.v(Lnc,oU);Lnc.prototype.C=function(){return[]};
g.v(g3y,oU);g3y.prototype.C=function(){var p=[];this.T.transfer&&p.push(this.T.transfer);this.T.adsPlaybackData&&p.push.apply(p,g.K(this.T.adsPlaybackData));this.T.drmLicense&&p.push(this.T.drmLicense);this.T.offlineVideoPolicy&&p.push(this.T.offlineVideoPolicy);this.T.videoDownloadContextEntity&&p.push(this.T.videoDownloadContextEntity);return[].concat(g.K(new Set(p)))};
g.v(Wn1,oU);Wn1.prototype.C=function(){return[]};
g.v(Qsr,oU);Qsr.prototype.C=function(){var p=[];this.T.offlineVideoStreams&&p.push.apply(p,g.K(this.T.offlineVideoStreams));this.T.captionTrack&&p.push.apply(p,g.K(this.T.captionTrack));return[].concat(g.K(new Set(p)))};
g.v(rEr,oU);rEr.prototype.C=function(){return[]};
g.v(BhG,oU);BhG.prototype.C=function(){return[]};
g.v(GiE,oU);GiE.prototype.C=function(){return[]};
g.v(psY,oU);psY.prototype.C=function(){return[]};
g.v(CZG,oU);CZG.prototype.C=function(){return[]};
g.v(jof,oU);jof.prototype.C=function(){return[]};
g.v(V1y,oU);V1y.prototype.C=function(){return[]};
g.v(NT0,oU);NT0.prototype.C=function(){return[]};
g.v(Hh1,oU);Hh1.prototype.C=function(){return[]};
g.v(Xsc,oU);Xsc.prototype.C=function(){return[]};
g.v(dk0,oU);dk0.prototype.C=function(){return[]};
g.v(ihF,oU);ihF.prototype.C=function(){return[]};
g.v(hu1,oU);hu1.prototype.C=function(){return[]};
g.v(sop,oU);sop.prototype.C=function(){return[]};
g.v(aeG,oU);aeG.prototype.C=function(){return[]};
g.v(EcE,oU);EcE.prototype.C=function(){return[]};
g.v(ler,oU);ler.prototype.C=function(){return[]};
var s1Y=["browse","music/browse","unplugged/browse"],cT2=["offline/playlist_sync_check"],Cfv=["offline"],aA1=["offline/offline_video_playback_position_sync"],lA0=["offline/get_playback_data_entity"],k8;x8.getInstance=function(){return g.I(function(p){return p.return(new Promise(function(C){g.BW().then(function(V){V?(x8.instance||(x8.instance=new x8(V)),C(x8.instance)):C(void 0)})}))})};
x8.prototype.get=function(p){var C=this,V,N,H;return g.I(function(X){if(X.C==1)return g.y(X,M1p(C.token),2);if(X.C!=3)return V=X.T,g.y(X,V.get("prefs",p),3);N=X.T;if(!N)return X.return();H=(0,g.U2)();return N.expirationTimestampMs<=H?X.return():X.return(N.value)})};
x8.prototype.set=function(p,C,V){V=V===void 0?31536E3:V;var N=this,H,X,d;return g.I(function(a){if(a.C==1)return H=(0,g.U2)(),X={key:p,value:C,expirationTimestampMs:H+V*1E3},g.y(a,M1p(N.token),2);d=a.T;return g.y(a,g.bN(d,"prefs",X),0)})};
x8.prototype.remove=function(p){var C=this,V;return g.I(function(N){if(N.C==1)return g.y(N,M1p(C.token),2);V=N.T;return g.y(N,V.delete("prefs",p),0)})};
g.v(Y8,g.LK);g.v(za,Shy);za.prototype.V=function(p,C){C=Dk5(C);p=(new TextEncoder).encode(JSON.stringify(p));return this.T.encrypt(p,C)};
za.prototype.C=function(p,C){if(!(p instanceof Uint8Array))throw JUE(1);var V=new TextDecoder;C=Dk5(C);p=this.T.decrypt(p,C);return JSON.parse(V.decode(p))};
var uL2={accountLinkStatusEntity:wi2,booleanEntity:kqE,buttonEntity:Xsc,captionTrack:Ppv,channelHandle:A$c,commerceAcquisitionClientPayloadEntity:ihF,commerceCartListEntity:hu1,contextNoteFeedEntityPayload:oNc,continuationTokenEntity:X2Y,downloadQualityPickerEntity:W0v,downloadsPageRefreshTokenEntity:r$P,downloadsPageViewConfigurationEntity:cEY,downloadStatusEntity:QXr,sfvAudioItemCurrentlyPlayingEntity:BhG,emojiFountainDataEntity:NT0,emojiCustomizationSetEntity:V1y,fakeChannel:xj8,fakePlaylist:Y$F,
fakePlaylistEntryCollection:RZG,fakeVideo:nN2,fakeVideoDescription:eZ0,featuredProductsEntity:SVv,flowStateEntity:P3v,iconBadgeEntity:sop,interstitialInteractionStateEntity:L0f,liveChatPollStateEntity:gNY,liveReactionsDataEntity:Hh1,logoEntity:$j5,macroMarkerEntity:Thf,mainDownloadsLibraryEntity:BUY,mainDownloadsListEntity:p28,mainPlaylistDownloadStateEntity:CpE,mainPlaylistEntity:d_E,mainPlaylistVideoEntity:iEF,mainVideoDownloadStateEntity:js5,mainVideoEntity:E30,markersEngagementPanelSyncEntity:MZv,
markersVisibilityOverrideEntity:JEp,musicAlbumReleaseDetail:yE2,musicAlbumReleaseDownloadMetadataEntity:ufE,musicAlbumRelease:OEY,musicAlbumReleaseUserDetail:qV5,musicArtistDetail:bEv,musicArtist:Iq8,musicArtistUserDetail:AEc,musicDownloadsLibraryEntity:ZEv,musicLibraryEdit:o3p,musicLibraryStatusEntity:ki1,musicPlaylist:YVr,musicPlaylistDownloadMetadataEntity:U_P,musicShare:zpf,musicTrackDetail:n32,musicTrackDownloadMetadataEntity:fq1,musicTrack:Rpy,musicTrackUserDetail:ep5,offlineOrchestrationActionWrapperEntity:w22,
offlineVideoPolicy:$_E,offlineVideoStreams:Lnc,offlineabilityEntity:VZf,orchestrationWebSamplingEntity:Nhv,pageHeaderEntity:CZG,pdpStateEntity:aeG,pinnedProductEntity:Kn0,playbackData:g3y,playerStateEntity:m_f,quantityIncrementerEntity:EcE,refresh:Wn1,saveToPlaylistListEntity:GiE,settingEntity:psY,suggestedFeedbackChipStateEntity:v3f,transfer:Qsr,trendingOfferEntity:D_1,videoDownloadContextEntity:rEr,videoOverviewAsyncDataEntity:ler,videoPlaybackPositionEntity:dk0,votingEntity:jof,ytMainChannelEntity:lq0,
youchatPendingResponseEntity:Fn5,ytMainDownloadedVideoEntity:HE8,ytMainVideoEntity:tZE};g.v($8,Shy);$8.prototype.V=function(p){return p};
$8.prototype.C=function(p){if(p instanceof Uint8Array)throw JUE(0);return p};
g.v(LC,g.z);LC.prototype.observe=function(p){var C=this;this.observers.push(p);return function(){var V=C.observers.indexOf(p);V>=0&&C.observers.splice(V,1)}};
LC.prototype.C=function(p){zuP(this,p.data)};
LC.prototype.CS=function(){this.channel.close()};
var wsf,RUf=new g.Ug("elementsCommand");var D2=new g.Ug("entityBatchUpdate");var fof=new g.Ug("downloadStatusEntity");var woY=new g.Ug("mainPlaylistEntityActionMetadata");var QZ=new g.Ug("mainVideoEntityActionMetadata");var ppr=new g.Ug("musicPlaylistEntityActionMetadata");var uVY=new g.Ug("musicTrackEntityActionMetadata");var XF0=new g.Ug("localImageEntityActionMetadata");var oz=new g.Ug("playbackDataActionMetadata");var nC1=new g.Ug("transferEntityActionMetadata");var ZoG=new g.Ug("videoPlaybackPositionEntityActionMetadata");var Xfr;new g.vi;new g.vi;aoy.prototype.request=function(p,C,V){C=C===void 0?{}:C;return this.locks.request(p,C,function(N){return V(N)})};var C8=g.xH.caches,p8,T91;Ga.prototype.open=function(p){return C8.open(thE(p))};
Ga.prototype.has=function(p){return C8.has(thE(p))};
Ga.prototype.delete=function(p){return C8.delete(thE(p))};
Ga.prototype.match=function(p,C){var V=this,N,H,X,d,a,E;return g.I(function(l){switch(l.C){case 1:return g.y(l,V.keys(),2);case 2:N=l.T,H=g.F(N),X=H.next();case 3:if(X.done){l.EY(5);break}d=X.value;return g.y(l,V.open(d),6);case 6:return a=l.T,g.y(l,a.match(p,C),7);case 7:if(E=l.T)return l.return(E);X=H.next();l.EY(3);break;case 5:return l.return()}})};
g.v(lo8,Ga);lo8.prototype.keys=function(){var p,C,V,N,H,X,d,a,E;return g.I(function(l){if(l.C==1)return p=[],C=g.g8("CacheStorage keys"),g.y(l,C8.keys(),2);V=l.T;N=g.F(V);for(H=N.next();!H.done;H=N.next()){X=H.value;var t=X.indexOf(":");d=t===-1?{Tx:X}:{Tx:X.substring(0,t),datasyncId:X.substring(t+1)};a=d.Tx;E=d.datasyncId;E===C&&p.push(a)}return l.return(p)})};g.v(VZ,g.z);VZ.prototype.V=function(p){this.api.Jk("onOfflineOperationFailure",p.data)};
VZ.prototype.S=function(p){this.api.publish("offlinetransferpause",p.data)};
VZ.prototype.CS=function(){var p;(p=this.T)==null||p.close();var C;(C=this.C)==null||C.close()};mKE.prototype.d6=function(){this.T&&HK(this)};
mKE.prototype.DH=function(){this.C&&this.C.resolve();this.V=this.T=!1;this.Z()};var NEY=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var xKv="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var WGf="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.v(Mrc,Iz);Mrc.prototype.C=function(p){return hg(p)?vCr(this,p):az(p)?KO5(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.v(DZF,Iz);DZF.prototype.C=function(p){return az(p)?uUc(this,p):UKP(p)?UZF(this,p):Es(p)?fA0(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.h=OoF.prototype;g.h.JQe=function(p){var C=this,V,N,H,X;return g.I(function(d){if(!g.r(p.state,128))return d.EY(0);V=p.state.Kd;var a=(N=V)==null?void 0:N.errorCode,E=(H=V)==null?void 0:H.ES;X=a==="net.connect"&&E===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(a==null?0:a.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.y(d,C.Xb(C.player.getVideoData().videoId,X),0)})};
g.h.Xb=function(p,C){var V=this;return g.I(function(N){if(N.C==1){if(V.C)return N.return();V.C=!0;return C==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Yw(V,p,!1,!0),N.EY(0)):g.y(N,xw(V,p),3)}g.mx(p,4);return g.y(N,V.T.Xb(C),0)})};
g.h.QG=function(p){p.status===2?(p.status!==this.V&&(ulF(this.T),g.mx(p.videoId,2)),p.Ll&&yCG(this.T,p.videoId,p.Ll)):p.status===4?(xw(this,p.videoId),this.Xb(p.videoId,p.Wu?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):p.status===1&&OX2(this.T);this.V=p.status;this.api.Jk("localmediachange",{videoId:p.videoId,status:p.status})};
g.h.YD=function(){var p=this,C;return g.I(function(V){if(V.C==1){if(p.C)return V.return();p.C=!0;C=p.player.getVideoData().videoId;return g.y(V,xw(p,C),2)}return g.y(V,p.T.YD(),0)})};
g.h.X2=function(p){switch(p){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.h.G=function(p){return this.api.K().G(p)};g.v(k21,Iz);k21.prototype.C=function(p){return hg(p)?YHc(this,p):az(p)?zzf(this,p):UKP(p)?Rz1(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};LOy.prototype.T=function(p,C){var V=p.action.actionMetadata.priority-C.action.actionMetadata.priority;V===0&&(p.T<C.T?V=-1:p.T>C.T&&(V=1));return V};g.v(zY,g.z);zY.prototype.CS=function(){this.Z&&this.Z();g.z.prototype.CS.call(this)};
zY.prototype.createAction=function(p,C){var V=g.Xq(p.entityKey).entityType,N=g.D9(16);return new Mw(V,N,p,C.actionId,C.rootActionId)};
zY.prototype.b_=function(p){var C=this,V,N,H,X,d,a,E,l,t;return g.I(function(c){if(c.C==1){if(C.fS())return c.return();N=(V=p.offlineOrchestrationActionWrapperEntity)!=null?V:new Set;H=[];X=g.F(N);for(d=X.next();!d.done;d=X.next())a=d.value,E=g.Xq(a),l=E.entityId,Q11(C.T,l)||H.push(a);return g.y(c,dPP(C,H),2)}t=c.T;return g.y(c,Xop(C,t),0)})};
zY.prototype.retry=function(){var p=this;return g.I(function(C){return g.y(C,iXr(p),0)})};sqy.prototype.N3=function(p,C){C=C===void 0?!0:C;var V=this,N,H,X,d,a,E,l,t;return g.I(function(c){switch(c.C){case 1:if(!V.T)return c.return();N=[];H=g.vx(V.T.T,C);X=[];for(d={JS:0};d.JS<H.length;d={JS:d.JS},d.JS++)a=H[d.JS],E=V.T.Us(a,"json3"),l=g.yg(E,{withCredentials:!0,format:"RAW"},3,500).then(function(T){return function(M){M={metadata:g.NF(H[T.JS]),trackData:M.xhr.responseText};X.push(M)}}(d)).gh(function(T){jx("Caption fetch error",T)}),N.push(l);
return g.y(c,bNy(N),2);case 2:return g.vv(c,3),g.y(c,Gy0(p,X),5);case 5:g.Fe(c,0);break;case 3:t=g.Sa(c),jx("Caption DB transaction error",t),g.JQ(c)}})};g.v(Rz,g.z);Rz.prototype.CS=function(){this.C&&this.C();g.z.prototype.CS.call(this)};
Rz.prototype.V=function(p){var C=this,V,N,H,X,d,a,E,l;return g.I(function(t){N=(V=p.transfer)!=null?V:new Set;H=[];X=g.F(N);for(d=X.next();!d.done;d=X.next())a=d.value,E=g.Xq(a),l=E.entityId,H.push(l);return H.length===0?t.return():g.y(t,lKY(C,H),0)})};g.v(JCG,g.z);g.h=JCG.prototype;g.h.CS=function(){this.sY&&this.sY();this.Vn.dispose();this.S.dispose();this.vr&&g.wW(this.Y.x5,this.vr);this.Wr&&g.wW(this.Y.x5,this.Wr);g.z.prototype.CS.call(this)};
g.h.cia=function(p){var C=this,V,N,H;return g.I(function(X){switch(X.C){case 1:V=g.d_(p,"transfer");if(C.T&&V===C.T.key){Yw(C.D,C.W,!0);C.S.stop();X.EY(0);break}return g.y(X,gp(C.C,{mode:"readwrite",L4:!0},function(d){return RU(d,V,"transfer").then(function(a){if(a&&a.transferState!=="TRANSFER_STATE_COMPLETE"&&a.transferState!=="TRANSFER_STATE_FAILED")return a.transferState="TRANSFER_STATE_PAUSED_BY_USER",P9(d,a,"transfer").then(function(){return a})})}),3);
case 3:N=X.T;if(!N){X.EY(0);break}if(!p||!C.V){X.EY(5);break}return g.y(X,ll(p,C.V,C.C,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.y(X,PK(C,p),7);case 7:H=X.T,ujP({videoId:p,Oh:N,offlineModeType:H}),g.JQ(X)}})};
g.h.qOo=function(){var p=this;if(this.T&&this.W){Yw(this.D,this.W,!1);var C=this.T,V=(C==null?0:C.key)?g.Xq(C.key).entityId:"";V&&this.V&&(new Promise(function(N,H){ll(V,p.V,p.C,"DOWNLOAD_STATE_PAUSED").catch(function(X){H(X)})})).catch(function(N){jx("Download state setting error",N)})}this.S.stop()};
g.h.wf=function(){this.T?FVy(this,this.T):ex(this)};
g.h.R7=function(p){var C=this;return g.I(function(V){switch(V.C){case 1:if(!C.T){V.EY(2);break}if(C.T.transferState==="TRANSFER_STATE_COMPLETE"||C.T.transferState==="TRANSFER_STATE_FAILED"||!p.transfer||!p.transfer.has(C.T.key)){V.EY(3);break}return g.y(V,Qa(C.C,C.T.key,"transfer"),4);case 4:C.T=V.T;if(C.T){V.EY(3);break}return g.y(V,SMr(C),3);case 3:if(C.T)return V.return();case 2:return g.y(V,ex(C),0)}})};
g.h.Xb=function(p,C){var V=this,N,H,X,d,a;return g.I(function(E){switch(E.C){case 1:if(!V.T){wQ(V,"onTransferFailure: "+p);E.EY(2);break}N=V.T;X=((H=N)==null?0:H.key)?g.Xq(N.key).entityId:"";a:switch(p){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var l=!1;break a;default:l=!0}return l&&qME(V)?g.y(E,$w(V,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.y(E,
IK2(V,p),5);case 5:if(!X||!V.V){E.EY(2);break}return g.y(E,ll(X,V.V,V.C,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.y(E,PK(V,X),9);case 9:d=E.T;dQ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:X,Oh:N,offlineModeType:d});if(!X||!V.V){E.EY(2);break}return g.y(E,ll(X,V.V,V.C,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:n8(V),a=ex(V,!0),C&&C(a),g.JQ(E)}})};
g.h.YD=function(p){var C=this,V,N,H,X,d,a,E,l,t,c,T,M;return g.I(function(J){switch(J.C){case 1:if(!C.T){wQ(C,"onMaybeTransferStreamsExpired");J.EY(2);break}return qME(C)?g.y(J,$w(C,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.y(J,IK2(C,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!C.V){J.EY(2);break}V=C.T;H=((N=V)==null?0:N.key)?g.Xq(V.key).entityId:"";if(!H){J.EY(2);break}return g.y(J,ll(H,C.V,C.C,"DOWNLOAD_STATE_FAILED"),2);case 9:return C.T||wQ(C,"onMaybeTransferStreamsExpiredRetryAttempting"),
X=C.T,a=((d=X)==null?0:d.key)?g.Xq(X.key).entityId:"",g.y(J,PK(C,a),10);case 10:return E=J.T,dQ({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:a,Oh:X,offlineModeType:E}),l=qEP(),g.RW(l,oz,{isEnqueuedForExpiredStreamUrlRefetch:!0}),t=g.d_(a,"playbackData"),c={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:t,actionMetadata:l},T=vK(new Mw("playbackData",a,c)),g.y(J,W9(C.C,T,"offlineOrchestrationActionWrapperEntity"),2);case 2:n8(C),M=ex(C,!0),
p&&p(M),g.JQ(J)}})};
var kzf={},bX0=(kzf.TRANSFER_STATE_TRANSFERRING=1,kzf.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,kzf);g.h=L8.prototype;g.h.xo=function(){return this.W.promise};
g.h.F1=function(){if(this.C&&this.D)return this.W.promise;koY(this).then(this.W.resolve).catch(this.W.reject);return this.W.promise};
g.h.YR=function(p){var C={};return C.playbackData=new Mrc(p,this.yn,this.T),C.transfer=new k21(p,this.yn),C.videoPlaybackPositionEntity=new DZF(p,this.yn),C};
g.h.aJ=function(){var p=this;return g.I(function(C){return p.C?g.y(C,mP2(p.C),0):C.EY(0)})};
g.h.ZB=function(){var p=this,C,V;return g.I(function(N){if(N.C==1)return p.C||p.D?g.y(N,p.xo(),2):N.return();p.J!==void 0&&(g.m1(p.J),p.J=void 0);p.S!==void 0&&(g.m1(p.S),p.S=void 0);(C=p.C)==null||C.dispose();p.C=void 0;(V=p.D)==null||V.dispose();p.D=void 0;p.api.Jk("onOrchestrationLostLeader");p.W=new g.vi;g.JQ(N)})};
g.h.isOrchestrationLeader=function(){return this.V.T};
g.h.Z2=function(){return g.I(function(p){return p.return(!1)})};
g.h.vN=function(p){var C=this.T;C.api.publish("offlinetransferpause",p);var V;(V=C.C)==null||V.postMessage(p)};
g.h.wf=function(p){var C,V;return g.I(function(N){if(N.C==1)return g.y(N,B9(),2);C=N.T;if(!C)return N.return();V=g.d_(p,"transfer");return g.y(N,gp(C,{mode:"readwrite",L4:!0},function(H){var X=RU(H,V,"transfer"),d=RU(H,g.d_(p,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.K3.all([X,d]).then(function(a){a=g.F(a);var E=a.next().value;var l=a.next().value;return E&&E.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(E.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",P9(H,E,"transfer").then(function(){dQ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:p,Oh:E,offlineModeType:l==null?void 0:l.offlineModeType});return g.K3.resolve(null)})):g.K3.resolve(null)})}),0)})};
g.h.gs=function(p){p=p===void 0?43200:p;var C=this,V,N,H,X,d,a,E,l;return g.I(function(t){if(t.C==1)return C.Y.xq()?g.y(t,B9(),2):t.return(xP2());if(t.C!=3){V=t.T;if(!V)return t.return([]);N=Date.now()/1E3;return g.y(t,rp(V,"offlineVideoPolicy"),3)}H=t.T;X=[];d=g.F(H);for(a=d.next();!a.done;a=d.next())E=a.value,Number(E.lastUpdatedTimestampSeconds)+p<=N&&(l=g.Xq(E.key).entityId,X.push(l));return X.length?t.return(gQ(C,X,C.Z,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):t.return([])})};
g.h.deleteAll=function(){return gQ(this,["!*$_ALL_ENTITIES_!*$"],this.Z,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.h.refreshAllStaleEntities=function(p){var C=this;return g.I(function(V){return V.C==1?g.y(V,C.gs(p),2):V.return(V.T)})};
g.h.setUpPositionSyncInterval=function(p){var C=this;this.S!==void 0&&(g.m1(this.S),this.S=void 0);var V=p!=null?p:864E5;this.S=g.MU(function(){C.zX(V)},V)};
g.h.zX=function(p){var C=this,V,N,H,X,d,a;return g.I(function(E){switch(E.C){case 1:return g.vv(E,2),g.y(E,x8.getInstance(),4);case 4:V=E.T;if(!V)throw Error("prefStorage is undefined");return g.y(E,V.get("psi"),5);case 5:N=E.T;X=((H=N)==null?0:H.Hy)?Number(N.Hy)/1E3:0;d=Date.now();if(!(X+p<=d)){E.EY(6);break}return g.y(E,gQ(C,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Fe(E,0);break;case 2:a=g.Sa(E),jx("Offline manager error",a),
g.JQ(E)}})};
g.h.y7=function(){var p=this,C,V,N,H,X,d,a;return g.I(function(E){if(E.C==1)return g.y(E,B9(),2);if(E.C!=3)return(C=E.T)?g.y(E,rp(C,"transfer"),3):E.return([]);V=E.T;N=[];H=g.F(V);for(X=H.next();!X.done;X=H.next())d=X.value,d.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&d.key&&(a=g.Xq(d.key).entityId,N.push(a));return E.return(zFf(p,N))})};
g.h.Ye=function(){return g.I(function(p){return p.return([])})};
g.h.dC=function(){return g.I(function(p){g.JQ(p)})};
g.h.VY=function(){return g.I(function(p){g.JQ(p)})};g.v(RFE,Iz);RFE.prototype.C=function(p){return hg(p)?PuF(this,p):az(p)?$PY(this,p):Es(p)?LVG(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var WK=[10];g.v(BEp,Iz);BEp.prototype.C=function(p){return hg(p)?CI5(this,p):az(p)?jL8(this,p):Es(p)?VJc(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var pFf=[10];g.v(Hg5,Iz);Hg5.prototype.C=function(p){return az(p)?d8f(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.v(ig0,L8);g.h=ig0.prototype;g.h.YR=function(p){var C=L8.prototype.YR.call(this,p);C.mainVideoEntity=new BEp(p,this.yn,this.T);C.mainPlaylistEntity=new RFE(p,this.yn,this.T);C.mainDownloadsListEntity=new Hg5(p,this.yn,this.T);return C};
g.h.refreshAllStaleEntities=function(p,C){var V=this,N,H,X,d,a,E,l,t,c,T,M;return g.I(function(J){switch(J.C){case 1:N=[];if(!V.yn.G("web_player_offline_playlist_auto_refresh")){J.EY(2);break}return g.y(J,hop(V,p,C),3);case 3:N=J.T;case 2:return g.y(J,x8.getInstance(),4);case 4:return H=J.T,g.y(J,(X=H)==null?void 0:X.get("sdois"),5);case 5:return d=J.T,g.y(J,(a=H)==null?void 0:a.get("lmqf"),6);case 6:E=J.T;if(!d){J.EY(7);break}t=N;c=t.concat;return g.y(J,sLp(V,d,(l=E)!=null?l:"SD",p===0),8);case 8:N=
c.call(t,J.T);case 7:return T=N,M=T.concat,g.y(J,L8.prototype.refreshAllStaleEntities.call(V,p,C),9);case 9:return N=M.call(T,J.T),J.return(N)}})};
g.h.Z2=function(p){var C,V,N,H,X,d,a,E;return g.I(function(l){if(l.C==1)return g.y(l,B9(),2);if(l.C!=3)return(C=l.T)?g.y(l,Qa(C,g.bS,"mainDownloadsListEntity"),3):l.return(!1);V=l.T;if((N=V)==null?0:(H=N.downloads)==null?0:H.length)for(X=g.d_(p,"mainVideoEntity"),d=g.F(V.downloads),a=d.next();!a.done;a=d.next())if(E=a.value,E.videoItem===X)return l.return(!0);return l.return(!1)})};
g.h.Ye=function(){var p=this,C,V,N,H,X,d,a,E;return g.I(function(l){if(l.C==1)return g.y(l,B9(),2);if(l.C!=3)return(C=l.T)?g.y(l,rp(C,"downloadStatusEntity"),3):l.return([]);V=l.T;N=[];H=g.F(V);for(X=H.next();!X.done;X=H.next())d=X.value,d.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&d.key&&(a=g.Xq(d.key).entityId,N.push(a));return N.length?(E={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},l.return(gQ(p,N,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
E))):l.return([])})};
g.h.VY=function(){var p;return g.I(function(C){return C.C==1?g.y(C,B9(),2):(p=C.T)?g.y(C,gp(p,{mode:"readwrite",L4:!0},function(V){return nC(V,"mainVideoEntity").then(function(N){var H=[];N=g.F(N);for(var X=N.next();!X.done;X=N.next()){X=X.value;var d=void 0;(d=X.userState)!=null&&d.playbackPosition||(d=g.Xq(X.key).entityId,d={key:g.d_(d,"videoPlaybackPositionEntity"),videoId:d,lastPlaybackPositionSeconds:"0"},H.push(P9(V,d,"videoPlaybackPositionEntity")),X.userState={playbackPosition:d.key},H.push(P9(V,
X,"mainVideoEntity")))}return g.K3.all(H)})}),0):C.return()})};
g.h.dC=function(){var p,C,V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,Y,W,L,VL,au,Q,e,G,m,P,p0,Sy,V8,fY,jy,Tp,r1;return g.I(function(u){if(u.C==1)return g.y(u,B9(),2);if(u.C!=3){p=u.T;if(!p)return u.return();C=g.d_("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.y(u,gp(p,{mode:"readonly",L4:!0},function(U){return g.K3.all([RU(U,C,"mainDownloadsListEntity"),RU(U,g.bS,"mainDownloadsListEntity"),nC(U,"mainVideoEntity"),nC(U,"mainPlaylistEntity")])}),3)}V=u.T;
N=g.F(V);H=N.next().value;X=N.next().value;d=N.next().value;a=N.next().value;E=H;l=X;t=d;c=a;T=new Set;if((M=E)==null?0:(J=M.downloads)==null?0:J.length)for(S=g.F(E.downloads),D=S.next();!D.done;D=S.next())Z=D.value,f=void 0,(q=(f=Z.videoItem)!=null?f:Z.playlistItem)&&T.add(q);if((A=l)==null?0:(Y=A.downloads)==null?0:Y.length)for(W=g.F(l.downloads),L=W.next();!L.done;L=W.next())VL=L.value,VL.videoItem&&T.add(VL.videoItem);au=new Set;Q=[];e=g.F(c);for(G=e.next();!G.done;G=e.next()){m=G.value;if(m.videos)for(P=
g.F(m.videos),p0=P.next();!p0.done;p0=P.next())Sy=p0.value,(V8=JSON.parse(g.Xq(Sy).entityId).videoId)&&au.add(V8);m.key&&!T.has(m.key)&&Q.push(m.key)}fY=g.F(t);for(jy=fY.next();!jy.done;jy=fY.next())Tp=jy.value,Tp.key&&!T.has(Tp.key)&&(r1=g.Xq(Tp.key).entityId,au.has(r1)||Q.push(Tp.key));return Q.length?g.y(u,wf2(p,Q),0):u.EY(0)})};g.v(aJ1,Iz);aJ1.prototype.C=function(p){return hg(p)?lJ2(this,p):az(p)?tJr(this,p):Es(p)?ck8(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var rQ=[10];g.v(MJc,Iz);MJc.prototype.C=function(p){return hg(p)?m80(this,p):az(p)?vFE(this,p):Es(p)?FlP(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var BK=[10];g.v(D82,Iz);D82.prototype.C=function(p){return hg(p)?fJy(this,p):az(p)?Og2(this,p):Es(p)?ykY(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var U85=[10];g.v(GY,L8);GY.prototype.YR=function(p){var C=L8.prototype.YR.call(this,p);C.musicTrack=new D82(p,this.T);C.musicPlaylist=new MJc(p,this.T);C.musicAlbumRelease=new aJ1(p,this.T);return C};
GY.prototype.refreshAllStaleEntities=function(p,C){var V=this,N,H,X;return g.I(function(d){if(d.C==1)return g.y(d,IJy(V,p,C),2);if(d.C!=3)return H=N=d.T,X=H.concat,g.y(d,L8.prototype.refreshAllStaleEntities.call(V,p,C),3);N=X.call(H,d.T);return d.return(N)})};g.v(bgc,g.IT);g.h=bgc.prototype;g.h.create=function(){var p=this;g.R(this,this.events);g.YS(this.yn)?this.T=new ig0(this.yn,this.player):g.YU(this.yn)&&(this.T=new GY(this.yn,this.player));this.events.U(this.player,"onPlaybackStartExternal",function(){p.SM()});
this.events.U(this.player,"videodatachange",function(){p.SM()});
this.yn.G("html5_offline_playback_position_sync")&&this.events.U(this.player,"presentingplayerstatechange",this.Dz)};
g.h.Om=function(){return!1};
g.h.mT=function(p,C,V,N){var H=this;return g.I(function(X){return H.T?X.return(gQ(H.T,p,C,V,N)):X.return(Promise.reject())})};
g.h.deleteAll=function(){return this.T.deleteAll()};
g.h.gs=function(p){return this.T.gs(p)};
g.h.refreshAllStaleEntities=function(p){return this.T.refreshAllStaleEntities(p)};
g.h.setUpPositionSyncInterval=function(p){this.T.setUpPositionSyncInterval(p)};
g.h.vN=function(p){this.T.vN(p)};
g.h.wf=function(p){return this.T.wf(p)};
g.h.SM=function(){var p=this,C;return g.I(function(V){C=p.player.getVideoData();return g.Hk(C)?AkE(C)&&p.C!==C.clientPlaybackNonce?g.y(V,oF5(p,C),0):V.EY(0):V.return()})};
g.h.Dz=function(p){var C=this,V,N,H,X,d,a,E;return g.I(function(l){if(l.C==1)return V=C.player.getVideoData(),N=V.Kx,g.T6(p,2)||g.T6(p,512)?g.y(l,B9(),2):l.return();if(l.C!=3){H=l.T;if(!H)return jx("PES is undefined"),l.return();X=V.videoId;return g.y(l,Qa(H,g.d_(X,"mainVideoEntity"),"mainVideoEntity"),3)}d=l.T;if(!d)return l.return();a=Math.floor(N).toString();E={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:a}};return g.y(l,C.mT([X],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
E),0)})};
g.h.isOrchestrationLeader=function(){return this.T.isOrchestrationLeader()};
g.h.updateDownloadState=function(p,C){var V,N,H,X;return g.I(function(d){if(d.C==1)return g.y(d,B9(),2);V=d.T;if(!V)return jx("PES is undefined"),d.return();N=g.Xq(p);H=N.entityType;X=N.entityId;return g.y(d,ll(X,H,V,C,!0),0)})};g.qA("offline",bgc);})(_yt_player);
